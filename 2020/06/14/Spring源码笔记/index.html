<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Spring高级框架ssh &#x3D; spring + struts + hibernate  ssm &#x3D; spring + springmvc + mybatis spring全家桶：脚⼿架框架Spring Boot、微服务框架Spring Cloud等等 主要课程内容 Spring概述（基本情况） 核心思想：IoC和AOP 手写实现IoC和AOP（自定义Spring框架） Spring IoC高级应">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring源码笔记">
<meta property="og:url" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Spring高级框架ssh &#x3D; spring + struts + hibernate  ssm &#x3D; spring + springmvc + mybatis spring全家桶：脚⼿架框架Spring Boot、微服务框架Spring Cloud等等 主要课程内容 Spring概述（基本情况） 核心思想：IoC和AOP 手写实现IoC和AOP（自定义Spring框架） Spring IoC高级应">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234023248.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234300775.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234332971.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234627143.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234748860.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234833559.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234943726.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235045356.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235114707.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235145114.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235253880.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235454769.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235527291.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235549486.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200615001832301.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200615002405694.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200615003008911.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619123958835.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619124121274.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619125434916.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619130543452.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619130848771.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619130905343.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200719225303716.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200719225325926.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200719225738831.png">
<meta property="og:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200719225816756.png">
<meta property="article:published_time" content="2020-06-14T15:23:56.000Z">
<meta property="article:modified_time" content="2020-07-19T15:07:34.153Z">
<meta property="article:author" content="hgx98">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234023248.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/06/14/Spring源码笔记/"/>





  <title>Spring源码笔记 | Hexo</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hgx98">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spring源码笔记</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-14T23:23:56+08:00">
                2020-06-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Spring高级框架"><a href="#Spring高级框架" class="headerlink" title="Spring高级框架"></a>Spring高级框架</h1><p>ssh = spring + struts + hibernate </p>
<p>ssm = spring + springmvc + mybatis</p>
<p>spring全家桶：脚⼿架框架Spring Boot、微服务框架Spring Cloud等等</p>
<h1 id="主要课程内容"><a href="#主要课程内容" class="headerlink" title="主要课程内容"></a>主要课程内容</h1><ul>
<li>Spring概述（基本情况）</li>
<li>核心思想：IoC和AOP</li>
<li>手写实现IoC和AOP（自定义Spring框架）</li>
<li>Spring IoC高级应用<ul>
<li>基础知识</li>
<li>高级特性</li>
</ul>
</li>
<li>Spring IoC源码深度剖析<ul>
<li>设计非常优雅</li>
<li>设计模式</li>
<li>注意原则、方法和技巧</li>
</ul>
</li>
<li>Spring AOP高级应用<ul>
<li>声明式事务控制</li>
</ul>
</li>
<li>Spring AOP源码深度剖析</li>
</ul>
<h1 id="第一部分-Spring概述"><a href="#第一部分-Spring概述" class="headerlink" title="第一部分 Spring概述"></a>第一部分 Spring概述</h1><h2 id="第1节-Spring简介"><a href="#第1节-Spring简介" class="headerlink" title="第1节 Spring简介"></a>第1节 Spring简介</h2><p>Spring 是分层的 full-stack（全栈） 轻量级开源框架，以 IoC 和 AOP 为内核，提供了展现层 Spring MVC 和业务层事务管理等众多的企业级应⽤技术，还能整合开源世界众多著名的第三⽅框架和类库，已经成为使用最多的 Java EE 企业应⽤开源框架。</p>
<p>Spring官方网址：<a href="http://spring.io/" target="_blank" rel="noopener"></a>，我们经常说的Spring其实指的是Spring Framework（Spring框架）</p>
<h2 id="第-2-节-Spring发展历程"><a href="#第-2-节-Spring发展历程" class="headerlink" title="第 2 节 Spring发展历程"></a>第 2 节 Spring发展历程</h2><ul>
<li><p>1997年 IBM 提出了EJB的思想；<br>  1998年，SUN 制定开发标准规范EJB1.0；<br>  1999年，EJB 1.1发布；<br>  2001年，EJB 2.0发布；<br>  2003年，EJB 2.1发布；<br>  2006年，EJB 3.0发布；</p>
</li>
<li><p>Rod Johnson（Spring之父）</p>
<ul>
<li><p>Expert One-to-One J2EE Design and Development(2002) 阐述了J2EE使⽤EJB开发设计的有点及解决方法</p>
</li>
<li><p>Expert One-to-One J2EE Development without EJB(2004) 阐述了J2EE开发不使⽤EJB的解决</p>
<p>  ⽅式（Spring雏形），2017 年 9 ⽉份发布了 Spring 的 新版本 Spring 5.0 通⽤版（GA）</p>
</li>
</ul>
</li>
</ul>
<h2 id="第-3-节-Spring的优势"><a href="#第-3-节-Spring的优势" class="headerlink" title="第 3 节 Spring的优势"></a>第 3 节 Spring的优势</h2><p>整个 Spring 优势，传达出⼀个信号，Spring 是⼀个综合性，且有很强的思想性框架，每学习⼀天，就能体会到它的⼀些优势。</p>
<ul>
<li>方便解耦，简化开发<br>  通过Spring提供的IoC容器，可以将对象间的依赖关系交由Spring进⾏控制，避免硬编码所造成的过度程序耦合。⽤户也不必再为单例模式类、属性⽂件解析等这些很底层的需求编写代码，可以更专注于上层的应⽤。</li>
<li>AOP编程的支持<br>  通过Spring的AOP功能，⽅便进⾏⾯向切⾯的编程，许多不容易⽤传统OOP实现的功能可以通过AOP轻松应付。</li>
<li>声明式事务的支持<br>  @Transactional可以将我们从单调烦闷的事务管理代码中解脱出来，通过声明式⽅式灵活的进⾏事务的管理，提⾼开发效率和质量。</li>
<li>方便程序的测试<br>  可以⽤⾮容器依赖的编程⽅式进⾏⼏乎所有的测试⼯作，测试不再是昂贵的操作，⽽是随⼿可做的事情。</li>
<li>方便集成各种优秀框架<br>  Spring可以降低各种框架的使⽤难度，提供了对各种优秀框架（Struts、Hibernate、Hessian、Quartz等）的直接⽀持。</li>
<li>降低JavaEE API的使用难度<br>  Spring对JavaEE API（如JDBC、JavaMail、远程调⽤等）进⾏了薄薄的封装层，使这些API的使⽤难度⼤为降低。</li>
<li>源码是经典的Java学习范例<br>  Spring的源代码设计精妙、结构清晰、匠⼼独⽤，处处体现着⼤师对Java设计模式灵活运⽤以及对Java技术的⾼深造诣。它的源代码无疑是Java技术的极佳实践的范例。</li>
</ul>
<h2 id="第-4-节-Spring的核心结构"><a href="#第-4-节-Spring的核心结构" class="headerlink" title="第 4 节 Spring的核心结构"></a>第 4 节 Spring的核心结构</h2><p>Spring是一个分层非常清晰并且依赖关系、职责定位⾮常明确的轻量级框架，主要包括几个大模块：数据处理模块、Web模块、AOP（Aspect Oriented Programming）/Aspects模块、Core Container模块和 Test 模块，如下图所示，Spring依靠这些基本模块，实现了⼀个令⼈愉悦的融合了现有解决⽅案的零侵⼊的轻量级框架。</p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234023248.png" alt="image-20200614234023248"></p>
<ul>
<li>Spring核心容器（Core Container） 容器是Spring框架最核心的部分，它管理着Spring应⽤中 bean的创建、配置和管理。在该模块中，包括了Spring bean工厂，它为Spring提供了DI的功能。<br>  基于bean工厂，我们还会发现有多种Spring应用上下⽂的实现。所有的Spring模块都构建于核⼼容器之上。</li>
<li>⾯向切⾯编程（AOP）/Aspects Spring对⾯向切⾯编程提供了丰富的⽀持。这个模块是Spring应<br>  ⽤系统中开发切⾯的基础，与DI⼀样，AOP可以帮助应⽤对象解耦。</li>
<li>数据访问与集成（Data Access/Integration）<br>  Spring的JDBC和DAO模块封装了⼤量样板代码，这样可以使得数据库代码变得简洁，也可以更专注于我们的业务，还可以避免数据库资源释放失败⽽引起的问题。 另外，Spring AOP为数据访问提供了事务管理服务，同时Spring还对ORM进⾏了集成，如Hibernate、MyBatis等。该模块由JDBC、Transactions、ORM、OXM 和 JMS 等模块组成。</li>
<li>Web 该模块提供了SpringMVC框架给Web应⽤，还提供了多种构建和其它应⽤交互的远程调⽤⽅案。 SpringMVC框架在Web层提升了应⽤的松耦合⽔平。</li>
<li>Test 为了使得开发者能够很⽅便的进⾏测试，Spring提供了测试模块以致⼒于Spring应⽤的测试。 通过该模块，Spring为使⽤Servlet、JNDI等编写单元测试提供了⼀系列的mock对象实现。</li>
</ul>
<h2 id="第-5-节-Spring框架版本"><a href="#第-5-节-Spring框架版本" class="headerlink" title="第 5 节 Spring框架版本"></a>第 5 节 Spring框架版本</h2><p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234300775.png" alt="image-20200614234300775"></p>
<p>Spring Framework不同版本对JDK的要求如下</p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234332971.png" alt="image-20200614234332971"></p>
<h1 id="第二部分-核心思想"><a href="#第二部分-核心思想" class="headerlink" title="第二部分 核心思想"></a>第二部分 核心思想</h1><p>​        注意：IOC和AOP不是spring提出的，在spring之前就已经存在，只不过更偏向于理论化，spring在技术层次把这两个思想做了⾮常好的实现（Java）</p>
<h2 id="第-1-节-IoC"><a href="#第-1-节-IoC" class="headerlink" title="第 1 节 IoC"></a>第 1 节 IoC</h2><h3 id="1-1-什么是IoC"><a href="#1-1-什么是IoC" class="headerlink" title="1.1 什么是IoC"></a>1.1 什么是IoC</h3><p>​        IoC Inversion of Control (控制反转/反转控制)，注意它是⼀个技术思想，不是⼀个技术实现描述的事情：Java开发领域对象的创建，管理的问题。<br>​        传统开发⽅式：⽐如类A依赖于类B，往往会在类A中new⼀个B的对象 IoC思想下开发⽅式：我们不⽤⾃⼰去new对象了，⽽是由IoC容器（Spring框架）去帮助我们实例化对象并且管理它，我们需要使⽤哪个对象，去问IoC容器要即可。我们丧失了⼀个权利（创建、管理对象的权利）,得到了⼀个福利（不⽤考虑对象的创建、管理等⼀系列事情）。<br>​        为什么叫做控制反转？<br>​        控制：指的是对象创建（实例化、管理）的权利。<br>​        反转：控制权交给外部环境了（spring框架、IoC容器）。</p>
<ul>
<li><strong>没有IoC容器的情况下</strong></li>
</ul>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234627143.png" alt="image-20200614234627143"></p>
<ul>
<li><strong>有IoC容器的情况下</strong><br>  <img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234748860.png" alt="image-20200614234748860"></li>
</ul>
<h3 id="1-2-IoC解决了什么问题"><a href="#1-2-IoC解决了什么问题" class="headerlink" title="1.2 IoC解决了什么问题"></a>1.2 IoC解决了什么问题</h3><p>IoC解决了对象之间的耦合问题</p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234833559.png" alt="image-20200614234833559"></p>
<h3 id="1-3-IoC和DI的区别"><a href="#1-3-IoC和DI的区别" class="headerlink" title="1.3 IoC和DI的区别"></a>1.3 IoC和DI的区别</h3><p>DI：Depen Injection（依赖注入）</p>
<p>怎么理解？</p>
<p>IoC和DI描述的是同一件事情，只不过角度不一样罢了。</p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614234943726.png" alt="image-20200614234943726"></p>
<h2 id="第-2-节-AOP"><a href="#第-2-节-AOP" class="headerlink" title="第 2 节 AOP"></a>第 2 节 AOP</h2><h3 id="2-1-什么是AOP"><a href="#2-1-什么是AOP" class="headerlink" title="2.1 什么是AOP"></a>2.1 什么是AOP</h3><p>AOP：Aspect oriented Programming ⾯向切⾯编程/⾯向⽅⾯编程。</p>
<p>AOP是OOP的延续，从OOP说起</p>
<p>OOP三⼤特征：封装、继承和多态</p>
<p>OOP是⼀种垂直继承体系</p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235045356.png" alt="image-20200614235045356"></p>
<p>OOP编程思想可以解决⼤多数的代码重复问题，但是有⼀些情况是处理不了的，⽐如下⾯的在顶级⽗类Animal中的多个⽅法中相同位置出现了重复代码，OOP就解决不了<br><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235114707.png" alt="image-20200614235114707"></p>
<p><strong>横切逻辑代码</strong></p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235145114.png" alt="image-20200614235145114"></p>
<p><strong>横切逻辑代码存在什么问题？</strong></p>
<ul>
<li>横切代码重复问题。</li>
<li>横切逻辑代码和业务代码混杂在一起，代码臃肿，维护不方便。</li>
</ul>
<p><strong>AOP出场，AOP独辟蹊径提出横向抽取机制，将横切逻辑代码和业务逻辑代码分析</strong></p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235253880.png" alt="image-20200614235253880"></p>
<p><strong>代码拆分容易，那么如何在不改变原有业务逻辑的情况下，悄⽆声息的把横切逻辑代码应⽤到原有的业务逻辑中，达到和原来⼀样的效果，这个是⽐较难的</strong></p>
<h3 id="2-2-AOP在解决什么问题"><a href="#2-2-AOP在解决什么问题" class="headerlink" title="2.2 AOP在解决什么问题"></a>2.2 AOP在解决什么问题</h3><p><strong>在不改变原有业务逻辑情况下，增强横切逻辑代码，根本上解耦合，避免横切逻辑代码重复。</strong></p>
<h3 id="2-3-为什么叫做面向切面编程"><a href="#2-3-为什么叫做面向切面编程" class="headerlink" title="2.3 为什么叫做面向切面编程"></a>2.3 为什么叫做面向切面编程</h3><p>切：指的是横切逻辑，原有业务逻辑代码我们不能动，只能操作横切逻辑代码，所以⾯向横切逻辑。</p>
<p>⾯：横切逻辑代码往往要影响的是很多个⽅法，每⼀个⽅法都如同⼀个点，多个点构成⾯，有⼀个</p>
<p>⾯的概念在⾥⾯。</p>
<h1 id="第三部分-手写实现IoC和AOP"><a href="#第三部分-手写实现IoC和AOP" class="headerlink" title="第三部分 手写实现IoC和AOP"></a>第三部分 手写实现IoC和AOP</h1><p>上⼀部分我们理解了 IoC 和 AOP 思想，我们先不考虑 Spring 是如何实现这两个思想的，此处准备了⼀个“银⾏转账”的案例，请分析该案例在代码层次有什么问题 ？分析之后使⽤我们已有知识解决这些问题（痛点）。其实这个过程我们就是在⼀步步分析并⼿写实现 IoC 和 AOP。</p>
<h2 id="第-1-节-银行转账案例界面"><a href="#第-1-节-银行转账案例界面" class="headerlink" title="第 1 节 银行转账案例界面"></a>第 1 节 银行转账案例界面</h2><p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235454769.png" alt="image-20200614235454769"></p>
<h2 id="第-2-节-银行转账案例表结构"><a href="#第-2-节-银行转账案例表结构" class="headerlink" title="第 2 节 银行转账案例表结构"></a>第 2 节 银行转账案例表结构</h2><p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235527291.png" alt="image-20200614235527291"></p>
<h2 id="第-3-节-银行转账案例代码调用关系"><a href="#第-3-节-银行转账案例代码调用关系" class="headerlink" title="第 3 节 银行转账案例代码调用关系"></a>第 3 节 银行转账案例代码调用关系</h2><p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200614235549486.png" alt="image-20200614235549486"></p>
<h2 id="第-4-节-银行转账案例关键代码"><a href="#第-4-节-银行转账案例关键代码" class="headerlink" title="第 4 节 银行转账案例关键代码"></a>第 4 节 银行转账案例关键代码</h2><ul>
<li><p>TranferServlet</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">@WebServlet</span>(name = <span class="string">"transferServlet"</span>, urlPatterns = <span class="string">"/transferServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 实例化service层对象</span></span><br><span class="line">    <span class="keyword">private</span> TransferService transferService = <span class="keyword">new</span> TransferServiceImpl();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 设置请求体的字符编码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">        String fromCardNo = req.getParameter(<span class="string">"fromCardNo"</span>);</span><br><span class="line">        String toCardNo = req.getParameter(<span class="string">"toCardNo"</span>);</span><br><span class="line">        String moneyStr = req.getParameter(<span class="string">"money"</span>);</span><br><span class="line">        <span class="keyword">int</span> money = Integer.parseInt(moneyStr);</span><br><span class="line">        </span><br><span class="line">        Result result = <span class="keyword">new</span> Result();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 2. 调用service层方法</span></span><br><span class="line">            transferService.transfer(fromCardNo, toCardNo, money);</span><br><span class="line">            result.setStatus(<span class="string">"200"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            result.setStatus(<span class="string">"201"</span>);</span><br><span class="line">            result.setMessage(e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 响应</span></span><br><span class="line">        resp.setContentType(<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">        resp.getWrite().print(JsonUtils.object2Json(result));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>TransferService接口及实现类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransferService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(String fromCardNo, String toCardNo, <span class="keyword">int</span> money)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferServiceImpl</span> <span class="keyword">implements</span> <span class="title">TransferService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao = <span class="keyword">new</span> AccountDaoImpl();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(String fromCardNo, String toCardNo, <span class="keyword">int</span> money)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Account from = accountDao.queryAccountByCardNo(fromCardNo);</span><br><span class="line">        Account to = accountDao.queryAccountByCardNo(toCardNo);</span><br><span class="line">        </span><br><span class="line">        from.setMoney(from.getMoney() - money);</span><br><span class="line">        to.setMoney(to.getMoney() + money);</span><br><span class="line">        </span><br><span class="line">        accountDao.updateAccountByCardNo(from);</span><br><span class="line">        accountDao.updateAccountByCardNo(to);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>AccountDao层接口及基于JDBC的实现类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Account <span class="title">queryAccountByCardNo</span><span class="params">(String cardNo)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateAccountByCardNo</span><span class="params">(Account account)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">queryAccountByCardNo</span><span class="params">(String cardNo)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Connection connection = DruidUtils.getInstance().getConnection();</span><br><span class="line">        String sql = <span class="string">"select * from account where cardNo = ?"</span>;</span><br><span class="line">        PreparedStatement preparedStatement = connection.preparedStatement(sql);</span><br><span class="line">        preparedStatement.setString(<span class="number">1</span>, cardNo);</span><br><span class="line">        ResultSet resultSet = preparedStatement.executeQuery();</span><br><span class="line">        </span><br><span class="line">        Account account = <span class="keyword">new</span> Account();</span><br><span class="line">        <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">            account.setCardNo(resultSet.getString(<span class="string">"cardNo"</span>));</span><br><span class="line">            account.setName(resultSet.getString(<span class="string">"name"</span>));</span><br><span class="line">            account.setCMoney(resultSet.getString(<span class="string">"money"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        resultSet.close();</span><br><span class="line">        preparedStatement.close();</span><br><span class="line">        connection.close();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> account;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateAccountByCardNo</span><span class="params">(Account account)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        Connection connection = DruidUtils.getInstance().getConnection();</span><br><span class="line">        String sql = <span class="string">"update account set money = ? where cardNo = ?"</span>;</span><br><span class="line">        PreparedStatement preparedStatement = connection.preparedStatement(sql);</span><br><span class="line">        preparedStatement.setInt(<span class="number">1</span>, account.getMoney());</span><br><span class="line">        preparedStatement.setString(<span class="number">2</span>, account.getCardNo());</span><br><span class="line">        <span class="keyword">int</span> i = preparedStatement.executeQuery();</span><br><span class="line">        </span><br><span class="line">        preparedStatement.close();</span><br><span class="line">        connection.close();</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="第-5-节-银行转账案例代码问题分析"><a href="#第-5-节-银行转账案例代码问题分析" class="headerlink" title="第 5 节 银行转账案例代码问题分析"></a>第 5 节 银行转账案例代码问题分析</h2><p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200615001832301.png" alt="image-20200615001832301"></p>
<ol>
<li>问题一：在上述案例实现中，service 层实现类在使⽤ dao 层对象时，直接在TransferServiceImpl 中通过 AccountDao accountDao = new JdbcAccountDaoImpl() 获得了 dao层对象，然⽽⼀个 new 关键字却将 TransferServiceImpl 和 dao 层具体的⼀个实现类JdbcAccountDaoImpl 耦合在了⼀起，如果说技术架构发⽣⼀些变动，dao 层的实现要使⽤其它技术，⽐如 Mybatis，思考切换起来的成本？每⼀个 new 的地⽅都需要修改源代码，重新编译，⾯向接⼝开发的意义将⼤打折扣？</li>
<li>问题二：service 层代码没有竟然还没有进⾏事务控制 ？！如果转账过程中出现异常，将可能导致数据库数据错乱，后果可能会很严重，尤其在⾦融业务。</li>
</ol>
<h2 id="第-6-节-问题解决思路"><a href="#第-6-节-问题解决思路" class="headerlink" title="第 6 节 问题解决思路"></a>第 6 节 问题解决思路</h2><ol>
<li>针对问题一思考：实例化对象的方式除了new之外，还有什么技术？反射（需要把类的全限定类名配置在xml中）</li>
<li>考虑使用设计模式中的工厂模式解耦，另外项目中旺旺有很多对象需要实例化，那就在工厂中使用反射技术实例化对象，工厂模式很合适。</li>
</ol>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200615002405694.png" alt="image-20200615002405694"></p>
<ol start="3">
<li><p>更进一步，代码中能否只声明所需实例的接口类型，不出现new也不出现工厂类的字眼，如下代码：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferServiceImpl</span> <span class="keyword">implements</span> <span class="title">TransferService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 仅仅声明Dao层接口</span></span><br><span class="line">    <span class="keyword">private</span> Account accountDao;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提供set方法供外部注入Dao层实现类对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 答案是能，声明一个变量并提供set方法，在反射的时候将所需要的对象注入进去即可。</p>
</li>
<li><p>针对问题二思考：service层没有添加事务控制，怎么办？没有事务就添加上事务控制，手动控制JDBC的Connection事务，但要注意将Connection和当前线程绑定（即保证一个线程只有一个Connection，这样操作才针对的是同一个Connection，进而控制的是同一个事务）。</p>
</li>
</ol>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200615003008911.png" alt="image-20200615003008911"></p>
<h2 id="第-7-节-案例代码改造"><a href="#第-7-节-案例代码改造" class="headerlink" title="第 7 节 案例代码改造"></a>第 7 节 案例代码改造</h2><ol>
<li><p>针对问题一的代码改造：</p>
<ul>
<li><p>beans.xml</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transferService"</span> <span class="attr">class</span>=<span class="string">"com.lagou.edu.service.impl.TransferServiceImpl"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"AccountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.lagou.edu.dao.impl.JdbcAccountDaoImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>增加BeanFactory.java</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactory</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ⼯⼚类的两个任务</span></span><br><span class="line"><span class="comment">	 * 任务⼀：加载解析xml，读取xml中的bean信息，通过反射技术实例化bean对象，然后放⼊map待⽤</span></span><br><span class="line"><span class="comment">	 * 任务⼆：提供接⼝⽅法根据id从map中获取bean（静态⽅法）</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        InputStream resourceAsStream = BeanFactory.class.getClassLoader().getResourceAsStream("beans.xml");</span><br><span class="line">        SAXReader saxReader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Document document = saxReader.read(resourceAsStream);</span><br><span class="line">            Element rootElement = document.getRootElement();</span><br><span class="line">            List&lt;Element&gt; list = rootElement.selectNodes(<span class="string">"//bean"</span>);</span><br><span class="line">            <span class="comment">// 实例化bean对象</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">                Element element = list.get(i);</span><br><span class="line">                String id = element.attributeValue(<span class="string">"id"</span>);</span><br><span class="line">                String clazz = element.attributeValue(<span class="string">"class"</span>);</span><br><span class="line">                Class&lt;?&gt; aClass = Class.forName(clazz);</span><br><span class="line">                Object o = aClass.newInstance();</span><br><span class="line">                map.put(id,o);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 维护bean之间的依赖关系</span></span><br><span class="line">            List&lt;Element&gt; propertyNodes = rootElement.selectNodes(<span class="string">"//property"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; propertyNodes.size(); i++) &#123;</span><br><span class="line">                Element element = propertyNodes.get(i);</span><br><span class="line">                <span class="comment">// 处理property元素</span></span><br><span class="line">                String name = element.attributeValue(<span class="string">"name"</span>);</span><br><span class="line">                String ref = element.attributeValue(<span class="string">"ref"</span>);</span><br><span class="line"></span><br><span class="line">                String parentId = element.getParent().attributeValue(<span class="string">"id"</span>);</span><br><span class="line">                Object parentObject = map.get(parentId);</span><br><span class="line">                Method[] methods = parentObject.getClass().getMethods();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; methods.length; j++) &#123;</span><br><span class="line">                    Method method = methods[j];</span><br><span class="line">                    <span class="keyword">if</span>((<span class="string">"set"</span> + name).equalsIgnoreCase(method.getName()))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// bean之间的依赖关系（注⼊bean）</span></span><br><span class="line">                        Object propertyObject = map.get(ref);</span><br><span class="line">                        method.invoke(parentObject,propertyObject);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 维护依赖关系后重新将bean放⼊map中</span></span><br><span class="line">                map.put(parentId,parentObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (DocumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> map.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ol>
<pre><code>- 修改TransferServlet

    <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(name=<span class="string">"transferSerlvet"</span>, urlPatterns=<span class="string">"/transferServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TransferService transferServlet = (TransferServlet) BeanFactory.getBean(<span class="string">"transferServlet"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

- 修改TransferServiceImpl

    <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferServiceImpl</span> <span class="keyword">implements</span> <span class="title">TransferService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><ol start="2">
<li><p>针对问题二的改造</p>
<ul>
<li><p>增加ConnectionUtils</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionUtils</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ThreadLocal&lt;Connection&gt; threadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;(); <span class="comment">//存储当前线程的连接</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 从当前线程获取连接 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">getCurrentThreadConn</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">        判断当前线程中是否已经绑定连接，如果没有绑定，需要从连接池获取⼀个连接绑定到当前线程 </span></span><br><span class="line"><span class="comment">    	*/</span></span><br><span class="line">        Connection connection = threadLocal.get();</span><br><span class="line">        <span class="keyword">if</span>(connection == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 从连接池拿连接并绑定到线程</span></span><br><span class="line">            connection = DruidUtils.getInstance().getConnection();</span><br><span class="line">            <span class="comment">// 绑定到当前线程</span></span><br><span class="line">            threadLocal.set(connection);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> connection;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>增加TransactionManager事务管理器类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionManager</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ConnectionUtils connectionUtils;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConnectionUtils</span><span class="params">(ConnectionUtils connectionUtils)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionUtils = connectionUtils;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开启事务</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beginTransaction</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        connectionUtils.getCurrentThreadConn().setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提交事务</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        connectionUtils.getCurrentThreadConn().commit();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 回滚事务</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        connectionUtils.getCurrentThreadConn().rollback();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>增加ProxyFactory代理工厂类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TransactionManager transactionManager;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransactionManager</span><span class="params">(TransactionManager transactionManager)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transactionManager = transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxy</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(<span class="keyword">this</span>.getClass().getClassLoader(), target.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                Object result = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="comment">// 开启事务</span></span><br><span class="line">                    transactionManager.beginTransaction();</span><br><span class="line">                    <span class="comment">// 调⽤原有业务逻辑</span></span><br><span class="line">                    result = method.invoke(target,args);</span><br><span class="line">                    <span class="comment">// 提交事务</span></span><br><span class="line">                    transactionManager.commit();</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    <span class="comment">// 回滚事务</span></span><br><span class="line">                    transactionManager.rollback();</span><br><span class="line">                    <span class="comment">// 异常向上抛出,便于servlet中捕获</span></span><br><span class="line">                    <span class="keyword">throw</span> e.getCause();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改beans.xml</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 跟标签beans，⾥⾯配置⼀个⼜⼀个的bean⼦标签，每⼀个bean⼦标签都代表⼀个类的配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- id标识对象，class是类的全限定类名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.lagou.edu.dao.impl.JdbcAccountDaoImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ConnectionUtils"</span> <span class="attr">ref</span>=<span class="string">"connectionUtils"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transferService"</span> <span class="attr">class</span>=<span class="string">"com.lagou.edu.service.impl.TransferServiceImpl"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- set+ name 之后锁定到传值的set⽅法了，通过反射技术可以调⽤该⽅法传⼊对应的值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"AccountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--配置新增的三个Bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connectionUtils"</span> <span class="attr">class</span>=<span class="string">"com.lagou.edu.utils.ConnectionUtils"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"com.lagou.edu.utils.TransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ConnectionUtils"</span> <span class="attr">ref</span>=<span class="string">"connectionUtils"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--代理对象⼯⼚--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"proxyFactory"</span> <span class="attr">class</span>=<span class="string">"com.lagou.edu.factory.ProxyFactory"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"TransactionManager"</span> <span class="attr">ref</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改JdbcAccountDaoImpl</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcAccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ConnectionUtils connectionUtils;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConnectionUtils</span><span class="params">(ConnectionUtils connectionUtils)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionUtils = connectionUtils;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">queryAccountByCardNo</span><span class="params">(String cardNo)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//从连接池获取连接</span></span><br><span class="line">        <span class="comment">// Connection con = DruidUtils.getInstance().getConnection();</span></span><br><span class="line">        Connection con = connectionUtils.getCurrentThreadConn();</span><br><span class="line">        String sql = <span class="string">"select * from account where cardNo=?"</span>;</span><br><span class="line">        PreparedStatement preparedStatement = con.prepareStatement(sql);</span><br><span class="line">        preparedStatement.setString(<span class="number">1</span>,cardNo);</span><br><span class="line">        ResultSet resultSet = preparedStatement.executeQuery();</span><br><span class="line">        Account account = <span class="keyword">new</span> Account();</span><br><span class="line">        <span class="keyword">while</span>(resultSet.next()) &#123;</span><br><span class="line">            account.setCardNo(resultSet.getString(<span class="string">"cardNo"</span>));</span><br><span class="line">            account.setName(resultSet.getString(<span class="string">"name"</span>));</span><br><span class="line">            account.setMoney(resultSet.getInt(<span class="string">"money"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        resultSet.close();</span><br><span class="line">        preparedStatement.close();</span><br><span class="line">        <span class="comment">//con.close();</span></span><br><span class="line">        <span class="keyword">return</span> account;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateAccountByCardNo</span><span class="params">(Account account)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 从连接池获取连接</span></span><br><span class="line">        <span class="comment">// 改造为：从当前线程当中获取绑定的connection连接</span></span><br><span class="line">        <span class="comment">//Connection con = DruidUtils.getInstance().getConnection();</span></span><br><span class="line">        Connection con = connectionUtils.getCurrentThreadConn();</span><br><span class="line">        String sql = <span class="string">"update account set money=? where cardNo=?"</span>;</span><br><span class="line">        PreparedStatement preparedStatement = con.prepareStatement(sql);</span><br><span class="line">        preparedStatement.setInt(<span class="number">1</span>,account.getMoney());</span><br><span class="line">        preparedStatement.setString(<span class="number">2</span>,account.getCardNo());</span><br><span class="line">        <span class="keyword">int</span> i = preparedStatement.executeUpdate();</span><br><span class="line">        preparedStatement.close();</span><br><span class="line">        <span class="comment">//con.close();</span></span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改TransferServlet</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(name=<span class="string">"transferServlet"</span>,urlPatterns = <span class="string">"/transferServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 实例化service层对象</span></span><br><span class="line">    <span class="comment">//private TransferService transferService = new TransferServiceImpl();</span></span><br><span class="line">    <span class="comment">//private TransferService transferService = (TransferService)</span></span><br><span class="line">    BeanFactory.getBean(<span class="string">"transferService"</span>);</span><br><span class="line">    <span class="comment">// 从⼯⼚获取委托对象（委托对象是增强了事务控制的功能）</span></span><br><span class="line">    <span class="comment">// ⾸先从BeanFactory获取到proxyFactory代理⼯⼚的实例化对象</span></span><br><span class="line">    <span class="keyword">private</span> ProxyFactory proxyFactory = (ProxyFactory) BeanFactory.getBean(<span class="string">"proxyFactory"</span>);</span><br><span class="line">    <span class="keyword">private</span> TransferService transferService = (TransferService) proxyFactory.getJdkProxy(BeanFactory.getBean(<span class="string">"transferService"</span>)) ;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 设置请求体的字符编码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">        String fromCardNo = req.getParameter(<span class="string">"fromCardNo"</span>);</span><br><span class="line">        String toCardNo = req.getParameter(<span class="string">"toCardNo"</span>);</span><br><span class="line">        String moneyStr = req.getParameter(<span class="string">"money"</span>);</span><br><span class="line">        <span class="keyword">int</span> money = Integer.parseInt(moneyStr);</span><br><span class="line">        Result result = <span class="keyword">new</span> Result();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 2. 调⽤service层⽅法</span></span><br><span class="line">            transferService.transfer(fromCardNo,toCardNo,money);</span><br><span class="line">            result.setStatus(<span class="string">"200"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            result.setStatus(<span class="string">"201"</span>);</span><br><span class="line">            result.setMessage(e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 响应</span></span><br><span class="line">        resp.setContentType(<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">        resp.getWriter().print(JsonUtils.object2Json(result));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doPost(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ol>
<h1 id="第四部分-Spring-IoC应用"><a href="#第四部分-Spring-IoC应用" class="headerlink" title="第四部分 Spring IoC应用"></a>第四部分 Spring IoC应用</h1><h2 id="第-1-节-Spring-IoC基础"><a href="#第-1-节-Spring-IoC基础" class="headerlink" title="第 1 节 Spring IoC基础"></a>第 1 节 Spring IoC基础</h2><p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619123958835.png" alt="image-20200619123958835"></p>
<h3 id="1-1-BeanFactory-与-ApplicationContext-区别"><a href="#1-1-BeanFactory-与-ApplicationContext-区别" class="headerlink" title="1.1 BeanFactory 与 ApplicationContext 区别"></a>1.1 BeanFactory 与 ApplicationContext 区别</h3><p>​        BeanFactory是Spring框架中IoC容器的顶层接⼝，它只是⽤来定义⼀些基础功能,定义⼀些基础规范，而 ApplicationContext是它的⼀个⼦接⼝，所以ApplicationContext是具备BeanFactory提供的全部功能的。<br>​        通常，我们称BeanFactory为SpringIOC的基础容器，ApplicationContext是容器的⾼级接⼝，⽐ BeanFactory要拥有更多的功能，⽐如说国际化⽀持和资源访问（xml，java配置类）等等。</p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619124121274.png" alt="image-20200619124121274"></p>
<p>启动IoC容器的方式</p>
<ul>
<li><p>Java环境下启动IoC容器</p>
<ul>
<li>ClassPathXmlApplicationContext：从类的根路径下加载配置文件（推荐使用）。</li>
<li>FileSystemXmlApplicationContext：从磁盘路径上加载配置文件。</li>
<li>AnnotationConfigApplicationContext：纯注解模式下启动Spring容器。</li>
</ul>
</li>
<li><p>Web环境下启动IoC容器</p>
<ul>
<li><p>从xml启动容器</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">web-app</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 配置Spring ioc容器的配置⽂件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 使⽤监听器启动Spring的IOC容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listenerclass</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listenerclass</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>从配置类启动容器</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">web-app</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">"http://java.sun.com/dtd/web-app_2_3.dtd"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 告诉ContextloaderListener知道我们使⽤注解的⽅式启动ioc容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置启动类的全限定类名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>com.lagou.edu.SpringConfig<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 使⽤监听器启动Spring的IOC容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listenerclass</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listenerclass</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<h3 id="1-2-纯xml模式"><a href="#1-2-纯xml模式" class="headerlink" title="1.2 纯xml模式"></a>1.2 纯xml模式</h3><p>本部分内容我们不采用一一讲解知识点的方式，而是采用Spring IoC纯xml模式改造我们前面手写的IoC和AOP实现，在改造的过程中把各个知识点串起来。</p>
<ul>
<li><p>xml头</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                           https://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>实例化Bean的三种方式</p>
<ul>
<li><p>方式一：使用无参构造函数<br>  在默认情况下，它会通过反射调用无参构造函数来创建对象。如果类中没有无参构造函数，将创建失败。</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置service对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.lagou.service.impl.TransferServiceImpl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二：使用静态方法创建<br>  在实际开发中，我们使用的对象有些时候并不是直接通过构造函数就可以创建出来的，它可能在创建的过程中会做很多额外的操作。此时会提供一个创建对象的方法，恰好这个方法是static修饰的方法，即是此种情况。<br>  例如我们在做JDBC操作时，会⽤到java.sql.Connection接⼝的实现类，如果是mysql数据库，那 么⽤的就 是JDBC4Connection，但是我们不会去写 JDBC4Connection connection = new JDBC4Connection() ，因 为我们要注册驱动，还要提供URL和凭证信息， ⽤ DriverManager.getConnection ⽅法来获取连接。<br>  那么在实际开发中，尤其早期的项⽬没有使⽤Spring框架来管理对象的创建，但是在设计时使⽤了 ⼯⼚模式 解耦，那么当接⼊spring之后，⼯⼚类创建对象就具有和上述例⼦相同特征，即可采⽤ 此种⽅式配置。</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使⽤静态⽅法创建对象的配置⽅式--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.lagou.factory.BeanFactory"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">"getTransferService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>方式三：使用实例化方法创建<br>  此种⽅式和上⾯静态⽅法创建其实类似，区别是⽤于获取对象的⽅法不再是static修饰的了，⽽是类中的一个普通⽅法。此种⽅式⽐静态⽅法创建的使⽤⼏率要⾼⼀些。<br>  在早期开发的项⽬中，⼯⼚类中的⽅法有可能是静态的，也有可能是⾮静态⽅法，当是⾮静态⽅法时，即可采⽤下⾯的配置⽅式：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使⽤实例⽅法创建对象的配置⽅式--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"beanFactory"</span> <span class="attr">class</span>=<span class="string">"com.lagou.factory.instancemethod.BeanFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transferService"</span> <span class="attr">factory-bean</span>=<span class="string">"beanFactory"</span> <span class="attr">factorymethod</span>=<span class="string">"getTransferService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Bean的X以及生命周期</p>
<ul>
<li><p>作用范围的改变<br>  在Spring框架管理Bean对象的创建时，Bean对象默认都是单例的，但是它支持配置的方式改变作用范围，作用范围官方提供的说明如下图：</p>
<p>  <img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619125434916.png" alt="image-20200619125434916">在上图中提供的这些选项中，我们实际开发中⽤到最多的作⽤范围就是singleton（单例模式）和 prototype（原型模式，也叫多例模式）。配置⽅式参考下⾯的代码：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置service对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transferService"</span> <span class="attr">class</span>=<span class="string">"com.lagou.service.impl.TransferServiceImpl"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不同作用范围的生命周期<br>  <strong>单例模式：singleton</strong><br>  对象出生：当创建容器时，对象就被创建了。<br>  对象活着：只要容器在，对象就一直活着。<br>  对象死亡：当销毁容器时，对象就被销毁了。<br>  一句话总结：单例模式的bean对象生命周期与容器相同。</p>
<p>  多例模式：prototype<br>  对象出生：当使用对象时，创建新的对象实例。<br>  对象活着：只要对象在使用中，就一直活着。<br>  对象死亡：当对象长时间不用时，被Java的垃圾回收器回收了。<br>  一句话总结：多例模式的bean对象，Spring框架只负责创建，不负责销毁。</p>
</li>
</ul>
</li>
<li><p>Bean标签属性<br>  在基于xml的IoC配置中，bean标签是最基础的标签。它表示了IoC容器中的⼀个对象。换句话 说，如果⼀个对象想让spring管理，在XML的配置中都需要使⽤此标签配置，Bean标签的属性如下：<br>  <strong>id属性：</strong> ⽤于给bean提供⼀个唯⼀标识。在⼀个标签内部，标识必须唯⼀。<br>  <strong>class属性：</strong>⽤于指定创建Bean对象的全限定类名。<br>  <strong>name属性：</strong>⽤于给bean提供⼀个或多个名称。多个名称⽤空格分隔。<br>  <strong>factory-bean属性：</strong>⽤于指定创建当前bean对象的⼯⼚bean的唯⼀标识。当指定了此属性之后， class属性失效。<br>  <strong>factory-method属性：</strong>⽤于指定创建当前bean对象的⼯⼚⽅法，如配合factory-bean属性使⽤， 则class属性失效。如配合class属性使⽤，则⽅法必须是static的。<br>  <strong>scope属性：</strong>⽤于指定bean对象的作⽤范围。通常情况下就是singleton。当要⽤到多例模式时， 可以配置为prototype。<br>  <strong>init-method属性：</strong>⽤于指定bean对象的初始化⽅法，此⽅法会在bean对象装配后调⽤。必须是 ⼀个⽆参⽅法。<br>  <strong>destory-method属性：</strong>⽤于指定bean对象的销毁⽅法，此⽅法会在bean对象销毁前执⾏。它只能为scope是singleton时起作⽤。</p>
</li>
<li><p><strong>DI依赖注入的xml配置</strong></p>
<ul>
<li><p>依赖注入分类</p>
<ul>
<li>按照注入的方式分类<br>  <strong>构造函数注入：</strong>顾名思义，就是利用带参构造函数实现对类成员的数据赋值。<br>  <strong>set方式注入：</strong>它是通过类成员的set方法实现数据的注入的。（使用最多的）</li>
<li>按照注入的数据类型分类<br>  <strong>基本类型和String：</strong>注入的数据类型是基本数据类型或者是字符串类型的数据。<br>  <strong>其他Bean类型：</strong>注入的数据类型是对象类型，称为其他Bean的原因是，这个对象是要求出现在IoC容器中的。那么针对当前Bean来说，就是其他Bean了。<br>  <strong>复杂类型（集合类型）：</strong>注入的数据类型是Array、List、Set、Map、Properties中的一种类型。</li>
</ul>
</li>
<li><p>依赖注入的配置实现之构造函数注入：顾名思义就是利用构造函数实现对类成员赋值。它的使用要求是，类中提供的构造函数参数个数必须和配置的参数个数一致，且数据类型匹配。同时需要注意的是，当没有无参构造时，则必须提供构造函数参数的注入，否则Spring框架会报错。<br>  <img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619130543452.png" alt="image-20200619130543452"></p>
<p>  在使用构造函数注入时，涉及的标签是constructor-arg，该标签有如下属性：<br>  name：⽤于给构造函数中指定名称的参数赋值。<br>  index：⽤于给构造函数中指定索引位置的参数赋值。<br>  value：⽤于指定基本类型或者String类型的数据。<br>  ref：⽤于指定其他Bean类型的数据。写的是其他bean的唯⼀标识。</p>
</li>
<li><p>依赖注入的配置实现之set方法注入<br>  顾名思义，就是利用字段的set方法实现赋值的注入方式。此种方式在实际开发中是使用最多的注入方式。<br>  <img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619130848771.png" alt="image-20200619130848771"><br>  <img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200619130905343.png" alt="image-20200619130905343"></p>
<p>  在使⽤set⽅法注⼊时，需要使⽤property标签，该标签属性如下：<br>  <strong>name：</strong>指定注⼊时调⽤的set⽅法名称。（注：不包含set这三个字⺟，Druid连接池指定属性名称）。<br>  <strong>value：</strong>指定注⼊的数据。它⽀持基本类型和String类型。<br>  <strong>ref：</strong>指定注⼊的数据。它⽀持其他bean类型。写的是其他bean的唯⼀标识。</p>
</li>
<li><p>复杂数据类型注入<br>  首先，解释一下复杂类型数据，它指的是集合类型数据。集合分为两类，一类是List结构（数据结构），一类是Map接口（键值对）。<br>  接下来就是注入的方式的选择，只能在构造函数和set方法中选择，我们的示例选用set方法注入。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String[] myArray;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; myMap;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; mySet;</span><br><span class="line">    <span class="keyword">private</span> Properties myProperties;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyArray</span><span class="params">(String[] myArray)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.myArray = myArray;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyMap</span><span class="params">(Map&lt;String, String&gt; myMap)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.myMap = myMap;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMySet</span><span class="params">(Set&lt;String&gt; mySet)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mySet = mySet;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyProperties</span><span class="params">(SProperties myProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.myProperties = myProperties;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myArray"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">value</span>&gt;</span>array1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>array2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>array3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myMap"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key1"</span> <span class="attr">value</span>=<span class="string">"value1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key2"</span> <span class="attr">value</span>=<span class="string">"value2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"key3"</span> <span class="attr">value</span>=<span class="string">"value3"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mySet"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">value</span>&gt;</span>set1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>set2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myMap"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">pros</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"prop1"</span>&gt;</span>value1<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"prop2"</span>&gt;</span>value2<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pros</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>  ​        在List结构的集合数据注⼊时， array，list , set 这三个标签通⽤，另外注值的value标签内部可以直接写值，也可以使⽤bean标签配置⼀个对象，或者⽤ref标签引⽤⼀个已经配合的bean的唯⼀标识。<br>  ​        在Map结构的集合数据注⼊时，map标签使⽤entry⼦标签实现数据注⼊，entry 标签可以使⽤key和value属性指定存⼊map中的数据。使⽤value-ref属性指定已经配置好的bean的引⽤。 同时entry标签中也可以使⽤ref标签，但是不能使⽤bean标签。⽽ property 标签中不能使⽤ref或者bean标签引⽤对象。</p>
</li>
</ul>
</li>
</ul>
<h3 id="1-3-xml与注解相结合模式"><a href="#1-3-xml与注解相结合模式" class="headerlink" title="1.3 xml与注解相结合模式"></a>1.3 xml与注解相结合模式</h3><p>注意：</p>
<ol>
<li>实际企业开发中，纯xml模式使用已经很少了。</li>
<li>引入注解功能，不需要引入额外的jar。</li>
<li>xml+注解结合模式，xml文件依然存在，所以，Spring IoC容器的启动仍然从加载xml开始。</li>
<li>哪些bean的定义写在xml中，哪些bean的定义使用注解：<br> 第三方jar中的bean定义在xml，比如Druid数据库连接池。<br> 自己开发的bean定义使用注解。</li>
</ol>
<ul>
<li><p>xml中标签与注解的对应（IoC）</p>
<table>
<thead>
<tr>
<th>xml形式</th>
<th>对应的注解形式</th>
</tr>
</thead>
<tbody><tr>
<td>标签</td>
<td>@Component(“accountDao”)，注解加在类上 bean的id属性内容直接配置在注解后⾯如果不配置，默认定义个这个bean的id为类 的类名⾸字⺟⼩写； <br>另外，针对分层代码开发提供了@Componenet的三种别名<strong>@Controller</strong>、 <strong>@Service</strong>、<strong>@Repository</strong>分别⽤于控制层类、服务层类、dao层类的bean定义， 四个注解的用法完全⼀样，只是为了更清晰的区分⽽已</td>
</tr>
<tr>
<td>标签的scope属性</td>
<td>@Scope(“prototype”)，默认单例，注解加在类上</td>
</tr>
<tr>
<td>标签的init-method属性</td>
<td>@PostConstruct，注解加在方法上，该方法就是初始化后调用的方法</td>
</tr>
<tr>
<td>标签的destory-method属性</td>
<td>@PreDestory，注解加在方法上，该方法就是销毁前调用的方法</td>
</tr>
</tbody></table>
</li>
<li><p>DI依赖注入的注解实现方式<br>  <strong>@Autowired</strong>（推荐使用）<br>  @Autowired为Spring提供的注解，需要导⼊包org.springframework.beans.factory.annotation.Autowired。<br>  @Autowired采取的策略为按照类型注⼊。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferServiceImpl</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  如上代码所示，这样装配回去spring容器中找到类型为AccountDao的类，然后将其注⼊进来。这 样会产⽣⼀个问题，当⼀个类型有多个bean值的时候，会造成⽆法选择具体注⼊哪⼀个的情况， 这个时候我们需要配合着@Qualifier使⽤。</p>
<p>  @Qualifier告诉Spring具体去装配哪个对象。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferServiceImpl</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(name=<span class="string">"jdbcAccountDaoImpl"</span>)</span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  这个时候我们就可以通过类型和名称定位到我们想注⼊的对象。</p>
<p>  <strong>@Resource</strong><br>  @Resource 注解由 J2EE 提供，需要导⼊包 javax.annotation.Resource。<br>  @Resource 默认按照 ByName ⾃动注⼊。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"studentDao"</span>)</span><br><span class="line">    <span class="keyword">private</span> StudentDao studentDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span>(type=<span class="string">"TeacherDao"</span>)</span><br><span class="line">    <span class="keyword">private</span> TeacherDao teacherDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"manDao"</span>,type=<span class="string">"ManDao"</span>)</span><br><span class="line">    <span class="keyword">private</span> ManDao manDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果同时指定了name和type，则从Spring上下⽂中找到唯⼀匹配的bean进⾏装配，找不 到则抛出异常。</li>
<li>如果指定了name，则从上下⽂中查找名称（id）匹配的bean进⾏装配，找不到则抛出异 常。</li>
<li>如果指定了type，则从上下⽂中找到类似匹配的唯⼀bean进⾏装配，找不到或是找到多个，都会抛出异常。</li>
<li>如果既没有指定name，⼜没有指定type，则⾃动按照byName⽅式进⾏装配。</li>
</ul>
<p>  <strong>注意：</strong><br>  @Resource 在 Jdk 11中已经移除，如果要使⽤，需要单独引⼊jar包</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.annotation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.annotation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="1-4-纯注解模式"><a href="#1-4-纯注解模式" class="headerlink" title="1.4 纯注解模式"></a>1.4 纯注解模式</h3><p>改造xml+注解模式，将xml中遗留的内容全部以注解的方式迁移出去，最终删除xml，从Java配置类启动。</p>
<p><strong>对应注解</strong></p>
<p>@Configuration 注解，表名当前类是⼀个配置类</p>
<p>@ComponentScan注解，替代 context:component-scan</p>
<p>@PropertySource注解，引⼊外部属性配置⽂件</p>
<p>@Import注解，引⼊其他配置类</p>
<p>@Value注解，对变量赋值，可以直接赋值，也可以使⽤ ${} 读取资源配置⽂件中的信息</p>
<p>@Bean注解，将⽅法返回对象加⼊ Spring IoC 容器</p>
<h2 id="第-2-节-Spring-IoC高级特性"><a href="#第-2-节-Spring-IoC高级特性" class="headerlink" title="第 2 节 Spring IoC高级特性"></a>第 2 节 Spring IoC高级特性</h2><h3 id="2-1-lazy-init延迟加载"><a href="#2-1-lazy-init延迟加载" class="headerlink" title="2.1 lazy-init延迟加载"></a>2.1 lazy-init延迟加载</h3><p>Bean的延迟加载（延迟创建）</p>
<p>ApplicationContext 容器的默认⾏为是在启动服务器时将所有 singleton bean 提前进⾏实例化。提前 实例化意味着作为初始化过程的⼀部分，ApplicationContext 实例会创建并配置所有的singleton bean。</p>
<p>比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"testBean"</span> <span class="attr">class</span>=<span class="string">"cn.lagou.LazyBean"</span> /&gt;</span></span><br><span class="line">该bean默认的设置为:</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"testBean"</span> <span class="attr">calss</span>=<span class="string">"cn.lagou.LazyBean"</span> <span class="attr">lazy-init</span>=<span class="string">"false"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>lazy-init=”false”，⽴即加载，表示在spring启动时，⽴刻进⾏实例化。</p>
<p>如果不想让⼀个singleton bean 在 ApplicationContext实现初始化时被提前实例化，那么可以将bean 设置为延迟实例化。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"testBean"</span> <span class="attr">calss</span>=<span class="string">"cn.lagou.LazyBean"</span> <span class="attr">lazy-init</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        设置 lazy-init 为 true 的 bean 将不会在 ApplicationContext 启动时提前被实例化，⽽是第⼀次向容器 通过 getBean 索取 bean 时实例化的。<br>​        如果⼀个设置了⽴即加载的 bean1，引⽤了⼀个延迟加载的 bean2 ，那么 bean1 在容器启动时被实例 化，而bean2 由于被 bean1 引⽤，所以也被实例化，这种情况也符合延时加载的 bean 在第⼀次调⽤ 时才被实例化的规则。<br>​        也可以在容器层次中通过在元素上使⽤ “default-lazy-init” 属性来控制延时初始化。如下⾯配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-lazy-init</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- no beans will be eagerly pre-instantiated... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        如果⼀个 bean 的 scope 属性为 scope=”pototype” 时，即使设置了 lazy-init=”false”，容器启动时也不 会实例化bean，⽽是调⽤ getBean ⽅法实例化的。</p>
<p><strong>应用场景</strong></p>
<ol>
<li>开启延迟加载一定程度提高容器启动和运转性能</li>
<li>对于不常使用的Bean设置延迟加载，这样偶尔使用的时候再加载，不必从一开始该Bean就占用资源。</li>
</ol>
<h3 id="2-2-FactoryBean和BeanFactory"><a href="#2-2-FactoryBean和BeanFactory" class="headerlink" title="2.2 FactoryBean和BeanFactory"></a>2.2 FactoryBean和BeanFactory</h3><p>​        BeanFactory接⼝是容器的顶级接⼝，定义了容器的⼀些基础⾏为，负责⽣产和管理Bean的⼀个⼯⼚， 具体使⽤它下⾯的⼦接⼝类型，⽐如ApplicationContext；此处我们重点分析FactoryBean </p>
<p>​        Spring中Bean有两种，⼀种是普通Bean，⼀种是⼯⼚Bean（FactoryBean），FactoryBean可以⽣成 某⼀个类型的Bean实例（返回给我们），也就是说我们可以借助于它⾃定义Bean的创建过程。 </p>
<p>​        Bean创建的三种⽅式中的静态⽅法和实例化⽅法和FactoryBean作⽤类似，FactoryBean使⽤较多，尤 其在Spring框架⼀些组件中会使⽤，还有其他框架和Spring框架整合时使⽤。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以让我们⾃定义Bean的创建过程（完成复杂Bean的定义）</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FactoryBean</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="comment">// 返回FactoryBean创建的Bean实例，如果isSingleton返回true，则该实例会放到Spring容器</span></span><br><span class="line">    的单例对象缓存池中Map</span><br><span class="line">        <span class="function">T <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="comment">// 返回FactoryBean创建的Bean类型</span></span><br><span class="line">    Class&lt;?&gt; getObjectType();</span><br><span class="line">    <span class="comment">// 返回作⽤域是否单例</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Company类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Company</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> scale;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">        CompanyFactoryBean类</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getScale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> scale;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScale</span><span class="params">(<span class="keyword">int</span> scale)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.scale = scale;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Company&#123;"</span> +</span><br><span class="line">            <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">            <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">            <span class="string">", scale="</span> + scale +</span><br><span class="line">            <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CompanyFactoryBean类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompanyFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Company</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String companyInfo; <span class="comment">// 公司名称,地址,规模</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCompanyInfo</span><span class="params">(String companyInfo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.companyInfo = companyInfo;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Company <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 模拟创建复杂对象Company</span></span><br><span class="line">        Company company = <span class="keyword">new</span> Company();</span><br><span class="line">        String[] strings = companyInfo.split(<span class="string">","</span>);</span><br><span class="line">        company.setName(strings[<span class="number">0</span>]);</span><br><span class="line">        company.setAddress(strings[<span class="number">1</span>]);</span><br><span class="line">        company.setScale(Integer.parseInt(strings[<span class="number">2</span>]));</span><br><span class="line">        <span class="keyword">return</span> company;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Company<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xml配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"companyBean"</span> <span class="attr">class</span>=<span class="string">"com.lagou.edu.factory.CompanyFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"companyInfo"</span> <span class="attr">value</span>=<span class="string">"拉勾,中关村,500"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试，获取FactoryBean产生的对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Object companyBean = applicationContext.getBean(<span class="string">"companyBean"</span>);</span><br><span class="line">System.out.println(<span class="string">"bean:"</span> + companyBean);</span><br><span class="line"><span class="comment">// 结果如下</span></span><br><span class="line">bean:Company&#123;name=<span class="string">'拉勾'</span>, address=<span class="string">'中关村'</span>, scale=<span class="number">500</span>&#125;</span><br></pre></td></tr></table></figure>

<p>测试，获取FactoryBean，需要在id之前添加 “&amp;”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Object companyBean = applicationContext.getBean(<span class="string">"&amp;companyBean"</span>);</span><br><span class="line">System.out.println(<span class="string">"bean:"</span> + companyBean);</span><br><span class="line"><span class="comment">// 结果如下</span></span><br><span class="line">bean:com.lagou.edu.factory.CompanyFactoryBean@<span class="number">53f</span>6fd09</span><br></pre></td></tr></table></figure>



<h3 id="2-3-后置处理器"><a href="#2-3-后置处理器" class="headerlink" title="2.3 后置处理器"></a>2.3 后置处理器</h3><p>Spring提供了两种后处理bean的扩展接口，分别为 <strong>BeanPostProcessor</strong> 和<strong>BeanFactoryPostProcessor</strong>，两者在使用上是有所区别的。</p>
<p>工厂初始化（BeanFactory）—&gt; Bean对象</p>
<p>在BeanFactory初始化之后可以使用BeanFactoryPostProcessor进行后置处理做一些事情</p>
<p>在Bean对象实例化（并不是Bean的整个生命周期完成）之后可以使用BeanPostProcessor进行后置处理做一些事情</p>
<p>注意:对象不一定是springbean，而springbean一定是个对象 SpringBean的生命周期</p>
<h4 id="2-3-1-BeanPostProcessor"><a href="#2-3-1-BeanPostProcessor" class="headerlink" title="2.3.1 BeanPostProcessor"></a>2.3.1 BeanPostProcessor</h4><p>BeanPostProcessor是针对Bean级别的处理，可以针对某个具体的Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NUllable</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>该接口提供了两个方法，分别在Bean的初始化方法前和初始化方法后执行，具体这个初始化方法指的是 什么方法，类似我们在定义bean时，定义了init-method所指定的方法。</p>
<p>定义一个类实现了BeanPostProcessor，默认是会对整个Spring容器中所有的bean进行处理。如果要对具体的某个bean处理，可以通过方法参数判断，两个类型参数分别为Object和String，第一个参数是每个bean的实例，第二个参数是每个bean的name或者id属性的值。所以我们可以通过第二个参数，来判断我们将要处理的具体的bean。</p>
<p>注意:处理是发生在Spring容器的实例化和依赖注入之后。</p>
<h4 id="2-3-2-BeanFactoryPostProcessor"><a href="#2-3-2-BeanFactoryPostProcessor" class="headerlink" title="2.3.2 BeanFactoryPostProcessor"></a>2.3.2 BeanFactoryPostProcessor</h4><p>BeanFactory级别的处理，是针对整个Bean的工厂进行处理，典型应用:PropertyPlaceholderConfigurer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanFactoryPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory varl)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 此接口只提供了一个方法，方法参数为ConfigurableListableBeanFactory，该参数类型定义了一些方法</p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200719225303716.png" alt="image-20200719225303716"></p>
<p>其中有个方法名为getBeanDefinition的方法，我们可以根据此方法，找到我们定义bean的 BeanDefinition对象。然后我们可以对定义的属性进行修改，以下是BeanDefinition中的方法</p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200719225325926.png" alt="image-20200719225325926"></p>
<p>⽅法名字类似我们bean标签的属性，setBeanClassName对应bean标签中的class属性，所以当我们拿到BeanDefinition对象时，我们可以⼿动修改bean标签中所定义的属性值。 </p>
<p><strong>BeanDefinition对象：</strong>我们在 XML 中定义的 bean标签，Spring 解析 bean 标签成为⼀个 JavaBean，这个JavaBean 就是 BeanDefinition。</p>
<p>注意：调⽤ BeanFactoryPostProcessor ⽅法时，这时候bean还没有实例化，此时 bean 刚被解析成 BeanDefinition对象。</p>
<h1 id="第五部分-Spring-IoC源码深度剖析"><a href="#第五部分-Spring-IoC源码深度剖析" class="headerlink" title="第五部分 Spring IoC源码深度剖析"></a>第五部分 Spring IoC源码深度剖析</h1><ul>
<li><p>好处：提⾼培养代码架构思维、深⼊理解框架 </p>
</li>
<li><p>原则 </p>
<ul>
<li>定焦原则：抓主线 </li>
<li>宏观原则：站在上帝视⻆，关注源码结构和业务流程（淡化具体某⾏代码的编写细节） </li>
</ul>
</li>
<li><p>读源码的⽅法和技巧 </p>
<ul>
<li>断点（观察调⽤栈） </li>
<li>反调（Find Usages） </li>
<li>经验（spring框架中doXXX，做具体处理的地⽅）</li>
</ul>
</li>
<li><p>Spring源码构建 </p>
<ul>
<li>下载源码（github） </li>
<li>安装gradle 5.6.3（类似于maven） Idea 2019.1 Jdk 11.0.5 </li>
<li>导⼊（耗费⼀定时间） </li>
<li>编译⼯程（顺序：core-oxm-context-beans-aspects-aop） </li>
<li>⼯程—&gt;tasks—&gt;compileTestJava</li>
</ul>
</li>
</ul>
<h2 id="第一节-Spring-IoC容器初始化主体流程"><a href="#第一节-Spring-IoC容器初始化主体流程" class="headerlink" title="第一节 Spring IoC容器初始化主体流程"></a>第一节 Spring IoC容器初始化主体流程</h2><h3 id="1-1-Spring-IoC的容器体系"><a href="#1-1-Spring-IoC的容器体系" class="headerlink" title="1.1 Spring IoC的容器体系"></a>1.1 Spring IoC的容器体系</h3><p>IoC容器是Spring的核心模块，是抽象了对象管理、依赖关系管理的框架解决⽅案。Spring 提供了很多的容器，其中 BeanFactory 是顶层容器（根容器），不能被实例化，它定义了所有 IoC 容器必须遵从的⼀套原则，具体的容器实现可以增加额外的功能，⽐如我们常⽤到的ApplicationContext，其下更具体的实现如 ClassPathXmlApplicationContext 包含了解析 xml 等⼀系列的内容， AnnotationConfigApplicationContext 则是包含了注解解析等⼀系列的内容。Spring IoC 容器继承体系非常聪明，需要使⽤哪个层次⽤哪个层次即可，不必使⽤功能大而全的。 </p>
<p>BeanFactory 顶级接口方法栈如下</p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200719225738831.png" alt="image-20200719225738831"></p>
<p>BeanFactory容器继承体系</p>
<p><img src="/2020/06/14/Spring%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/image-20200719225816756.png" alt="image-20200719225816756"></p>
<p>通过其接口设计，我们可以看到我们⼀贯使⽤的 ApplicationContext 除了继承BeanFactory的⼦接口， 还继承了ResourceLoader、MessageSource等接口，因此其提供的功能也就更丰富了。 下⾯我们以 ClasspathXmlApplicationContext 为例，深⼊源码说明 IoC 容器的初始化流程。</p>
<h3 id="1-2-Bean生命周期关键时机点"><a href="#1-2-Bean生命周期关键时机点" class="headerlink" title="1.2 Bean生命周期关键时机点"></a>1.2 Bean生命周期关键时机点</h3><p><strong>思路：</strong>创建⼀个类 LagouBean ，让其实现⼏个特殊的接⼝，并分别在接⼝实现的构造器、接⼝⽅法中断点，观察线程调⽤栈，分析出 Bean 对象创建和管理关键点的触发时机。</p>
<p>LagouBean类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lagou;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.DisposableBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanFactoryPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.ConfigurableListableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LagouBean</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span></span>&#123;</span><br><span class="line">    <span class="comment">/* 构造函数 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LagouBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LagouBean 构造器..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* InitializingBean 接⼝实现 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LagouBean afterPropertiesSet..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BeanPostProcessor接口实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lagou;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBeanPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"BeanPostProcessor 实现类构造函数..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"lagouBean"</span>.equals(beanName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">"BeanPostProcessor 实现类 postProcessBeforeInitialization ⽅法被调⽤中......"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"lagouBean"</span>.equals(beanName)) &#123;</span><br><span class="line">			System.out.println(<span class="string">"BeanPostProcessor 实现类 postProcessAfterInitialization ⽅法被调⽤中......"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BeanFactoryPostProcessor接口实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lagou;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanFactoryPostProcessor;</span><br><span class="line"><span class="keyword">import</span></span><br><span class="line">org.springframework.beans.factory.config.ConfigurableListableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanFactoryPostProcessor</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBeanFactoryPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"BeanFactoryPostProcessor的实现类构造函数..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"BeanFactoryPostProcessor的实现⽅法调⽤中......"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                           https://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"lagouBean"</span> <span class="attr">class</span>=<span class="string">"com.lagou.LagouBean"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myBeanFactoryPostProcessor"</span> <span class="attr">class</span>=<span class="string">"com.lagou.MyBeanFactoryPostProcessor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myBeanPostProcessor"</span> <span class="attr">class</span>=<span class="string">"com.lagou.MyBeanPostProcessor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>IoC容器源码分析用例</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/29/SpringBoot/" rel="next" title="SpringBoot">
                <i class="fa fa-chevron-left"></i> SpringBoot
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/08/08/Linux/" rel="prev" title="Linux">
                Linux <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="hgx98" />
            
              <p class="site-author-name" itemprop="name">hgx98</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring高级框架"><span class="nav-text">Spring高级框架</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#主要课程内容"><span class="nav-text">主要课程内容</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第一部分-Spring概述"><span class="nav-text">第一部分 Spring概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第1节-Spring简介"><span class="nav-text">第1节 Spring简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-2-节-Spring发展历程"><span class="nav-text">第 2 节 Spring发展历程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-3-节-Spring的优势"><span class="nav-text">第 3 节 Spring的优势</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-4-节-Spring的核心结构"><span class="nav-text">第 4 节 Spring的核心结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-5-节-Spring框架版本"><span class="nav-text">第 5 节 Spring框架版本</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第二部分-核心思想"><span class="nav-text">第二部分 核心思想</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第-1-节-IoC"><span class="nav-text">第 1 节 IoC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-什么是IoC"><span class="nav-text">1.1 什么是IoC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-IoC解决了什么问题"><span class="nav-text">1.2 IoC解决了什么问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-IoC和DI的区别"><span class="nav-text">1.3 IoC和DI的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-2-节-AOP"><span class="nav-text">第 2 节 AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-什么是AOP"><span class="nav-text">2.1 什么是AOP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-AOP在解决什么问题"><span class="nav-text">2.2 AOP在解决什么问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-为什么叫做面向切面编程"><span class="nav-text">2.3 为什么叫做面向切面编程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第三部分-手写实现IoC和AOP"><span class="nav-text">第三部分 手写实现IoC和AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第-1-节-银行转账案例界面"><span class="nav-text">第 1 节 银行转账案例界面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-2-节-银行转账案例表结构"><span class="nav-text">第 2 节 银行转账案例表结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-3-节-银行转账案例代码调用关系"><span class="nav-text">第 3 节 银行转账案例代码调用关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-4-节-银行转账案例关键代码"><span class="nav-text">第 4 节 银行转账案例关键代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-5-节-银行转账案例代码问题分析"><span class="nav-text">第 5 节 银行转账案例代码问题分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-6-节-问题解决思路"><span class="nav-text">第 6 节 问题解决思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-7-节-案例代码改造"><span class="nav-text">第 7 节 案例代码改造</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第四部分-Spring-IoC应用"><span class="nav-text">第四部分 Spring IoC应用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第-1-节-Spring-IoC基础"><span class="nav-text">第 1 节 Spring IoC基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-BeanFactory-与-ApplicationContext-区别"><span class="nav-text">1.1 BeanFactory 与 ApplicationContext 区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-纯xml模式"><span class="nav-text">1.2 纯xml模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-xml与注解相结合模式"><span class="nav-text">1.3 xml与注解相结合模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-纯注解模式"><span class="nav-text">1.4 纯注解模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第-2-节-Spring-IoC高级特性"><span class="nav-text">第 2 节 Spring IoC高级特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-lazy-init延迟加载"><span class="nav-text">2.1 lazy-init延迟加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-FactoryBean和BeanFactory"><span class="nav-text">2.2 FactoryBean和BeanFactory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-后置处理器"><span class="nav-text">2.3 后置处理器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-BeanPostProcessor"><span class="nav-text">2.3.1 BeanPostProcessor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-BeanFactoryPostProcessor"><span class="nav-text">2.3.2 BeanFactoryPostProcessor</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第五部分-Spring-IoC源码深度剖析"><span class="nav-text">第五部分 Spring IoC源码深度剖析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第一节-Spring-IoC容器初始化主体流程"><span class="nav-text">第一节 Spring IoC容器初始化主体流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-Spring-IoC的容器体系"><span class="nav-text">1.1 Spring IoC的容器体系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Bean生命周期关键时机点"><span class="nav-text">1.2 Bean生命周期关键时机点</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hgx98</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
