<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="前言 框架：半成品软件  高度抽取可重用代码的一种设计，高度通用性  Spring  容器（可以管理所有的组件）框架；  核心关注：IOC和AOP；  Spring（IOC和AOP）      Test：Spring的单元测试模块   1- spring-test-5.2.6.RELEASE.jar  Core Container：核心容器（IOC）；黑色代表这部分的功能由哪些jar包组成；要使用">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring">
<meta property="og:url" content="http://yoursite.com/2020/05/24/Spring/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="前言 框架：半成品软件  高度抽取可重用代码的一种设计，高度通用性  Spring  容器（可以管理所有的组件）框架；  核心关注：IOC和AOP；  Spring（IOC和AOP）      Test：Spring的单元测试模块   1- spring-test-5.2.6.RELEASE.jar  Core Container：核心容器（IOC）；黑色代表这部分的功能由哪些jar包组成；要使用">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/1.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/2.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524161111759.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524164731869.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524205418172.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524205737181.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524211615779.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524211810150.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524215133198.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524220053438.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524220258855.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524220459086.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524221944432.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524222626187.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524160113400.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200524160243205.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200525121331811.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200525121429768.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200525121500268.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200525121549922.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200525122445676.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200525122645929.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200525122715613.png">
<meta property="og:image" content="http://yoursite.com/2020/05/24/Spring/image-20200525122747267.png">
<meta property="article:published_time" content="2020-05-24T14:33:47.000Z">
<meta property="article:modified_time" content="2020-05-25T13:32:59.527Z">
<meta property="article:author" content="hgx98">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/05/24/Spring/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/05/24/Spring/"/>





  <title>Spring | Hexo</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/24/Spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hgx98">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spring</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-24T22:33:47+08:00">
                2020-05-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><ol>
<li><p>框架：半成品软件</p>
<p> 高度抽取可重用代码的一种设计，高度通用性</p>
</li>
<li><p>Spring</p>
<p> 容器（可以管理所有的组件）框架；</p>
<p> 核心关注：IOC和AOP；</p>
</li>
<li><p>Spring（IOC和AOP）</p>
<p> <img src="/2020/05/24/Spring/1.png" alt="1"></p>
</li>
</ol>
<ul>
<li><p>Test：Spring的单元测试模块</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- spring-test-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>Core Container：核心容器（IOC）；黑色代表这部分的功能由哪些jar包组成；要使用这部分的完整功能，这些jar包都需要导入。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- spring-beans-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br><span class="line">- spring-core-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br><span class="line">- spring-context-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br><span class="line">- spring-expression-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>AOP+Aspects（面向切面编程模块）</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- spring-aop-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>Data Access（数据访问）：Spring访问数据库模块</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- spring-tx-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar	（事务）</span><br><span class="line">- spring-jdbc-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br><span class="line">- spring-orm-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br><span class="line">- spring-oxm-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>Web：Spring开发Web应用的模块。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- spring-web-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar	（新的技术）</span><br><span class="line">- spring-webmvc-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar    （原生的web相关（servlet））</span><br><span class="line">- spring-websocket-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar   （ 开发web项目的jar包）</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h1 id="一、IOC"><a href="#一、IOC" class="headerlink" title="一、IOC"></a>一、IOC</h1><p><img src="/2020/05/24/Spring/2.png" alt="2"></p>
<ul>
<li><p>概念：Inversion Of Control：控制反转；</p>
</li>
<li><p><strong>org.springframework.context.ApplicationContext</strong>接口表示Spring IoC容器，负责实例化，配置和组装bean。 容器通过读取配置元数据获取有关要实例化，配置和组装的对象的指令。 配置元数据以XML，Java注释或Java代码表示。 它允许表达组成应用程序的对象以及这些对象之间丰富的相互依赖性。</p>
</li>
<li><p>IoC是<strong>spring的核心</strong>，贯穿始终。<strong>所谓IoC，对于spring框架来说，就是由spring来负责控制对象的生命周期和对象间的关系</strong>。Spring所倡导的开发方式就是如此，所有的类都会在spring容器中登记，告诉spring你是个什么东西，你需要什么东西，然后spring会在系统运行到适当的时候，把你要的东西主动给你，同时也把你交给其他需要你的东西。所有的类的创建、销毁都由 spring来控制，也就是说控制对象生存周期的不再是引用它的对象，而是spring。对于某个具体的对象而言，以前是它控制其他对象，现在是所有对象都被spring控制，所以这叫控制反转。</p>
</li>
<li><p>控制：资源的获取方式</p>
<ul>
<li><p>主动式：需要什么资源都自己创建即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BookServlet&#123;</span><br><span class="line">    BookServlet bs = <span class="keyword">new</span> BookServlet();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>被动式：资源的获取不是自己创建，而是交给容易来创建和设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServlet</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BookServlet bs;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        bs.checkOut();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>容器：管理所有的组件（有功能的类）；假设BookServlet受容器管理，BookService也受容器管理；容器可以自动的探测出哪些组件（类）需要用到另一些组件（类）；容器帮我们创建BookService对象，并把BookService对象赋值过去。</p>
</li>
</ul>
</li>
<li><p>容器：主动的new资源变为被动的接受资源；以前是字节new对象，现在所有的对象交给容器创建（给容器中注册组件）。</p>
</li>
<li><p>DI：Dependency Injection，依赖注入；</p>
<ul>
<li>容器能知道哪个组件（类）运行的时候，需要另外一个类（组件）；容器通过反射的形式将容器中准备好的BookService对象注入（利用反射给属性赋值）到BookService中；</li>
<li>只要是容器管理的组件都能使用容器提供的强大功能。</li>
</ul>
</li>
</ul>
<h2 id="1、编写HelloWorld流程"><a href="#1、编写HelloWorld流程" class="headerlink" title="1、编写HelloWorld流程"></a>1、编写HelloWorld流程</h2><ol>
<li>导包：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring-expression-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br><span class="line">spring-core-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br><span class="line">spring-context-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br><span class="line">spring-beans-<span class="number">5.2</span><span class="number">.6</span>.RELEASE.jar</span><br><span class="line">commons-logging-<span class="number">1.2</span>.jar</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>编写bean类。在编写bean类是要注意，不要随意修改getter/setter方法的名字，因为在容器中构建组件的时候，&lt;property&gt;标签的name属性值为getter/setter方法的名字去掉get/set后的字符串首字母小写。即：setLastname()方法的name属性值为lastname。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hgx98.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String lastName, <span class="keyword">int</span> age, String gender, String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String lastName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>写配置</p>
<p> Spring的配置文件中集合了Spring的IOC容器管理的所有组件；</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person01"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"zhangsan"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"16"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"zhangsan@qq.com"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person02"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"lisi"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"lisi@qq.com"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"19"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>取出组件</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IOCTest</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ApplicationContext代表ioc容器</span></span><br><span class="line">    <span class="comment">// ClassPathXmlApplicationContext：当前应用的xml配置文件在ClassPath下</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext ioc = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"ioc.xml"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 通过组件的id获得容器中的组件 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 根据Spring的配置文件得到IOC容器对象</span></span><br><span class="line">        Person person01 = (Person) ioc.getBean(<span class="string">"person01"</span>);</span><br><span class="line">        System.out.println(person01);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">    	根据bean的类型从IOC容器中获取bean的实例 </span></span><br><span class="line"><span class="comment">    	该方式的好处是在取出组件时不需要进行类型转换</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果IOC容器中这个类型的bean有多个，使用以下方法取出组件就会报错</span></span><br><span class="line">        Person bean1 = ioc.getBean(Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(bean1);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 可以使用另一种重载的方法</span></span><br><span class="line">        Person bean2 = ioc.getBean(<span class="string">"Person01"</span>, Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(bean2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="2、给bean的属性赋值"><a href="#2、给bean的属性赋值" class="headerlink" title="2、给bean的属性赋值"></a>2、给bean的属性赋值</h2><p><strong>Person类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hgx98.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; bookList;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; map;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Car类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hgx98.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String carName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> price;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Construtor、getter/setter、toString() */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Book类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hgx98.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Construtor、getter/setter、toString() */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-1-赋值的途径"><a href="#2-1-赋值的途径" class="headerlink" title="2.1 赋值的途径"></a>2.1 赋值的途径</h3><ol>
<li>通过bean的setXxx()方法赋值</li>
</ol>
<p><img src="/2020/05/24/Spring/image-20200524161111759.png" alt="image-20200524161111759"></p>
<ol start="2">
<li>通过bean的构造器赋值</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">"zhangsan"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">"18"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">"male"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">"122@qq.com"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span> &gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过构造器的索引值指定参数位置赋值</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.person"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">"19"</span> <span class="attr">index</span> =<span class="string">"1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">"zhangsan"</span> <span class="attr">index</span> =<span class="string">"0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">"male"</span> <span class="attr">index</span> =<span class="string">"2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">"1232@qq.com"</span> <span class="attr">index</span> =<span class="string">"3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span> &gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>级联属性赋值</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Car"</span> <span class="attr">id</span>=<span class="string">"bmw350"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"carName"</span> <span class="attr">value</span>=<span class="string">"BMW350"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">value</span>=<span class="string">"580000"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person01"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"马化腾"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"37"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"tencent@qq.com"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">ref</span>=<span class="string">"bmw350"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>p名称空间：为了简化XML文件的配置，越来越多的XML文件采用属性而非子元素配置信息。<br> Spring从2.5版本开始引入了一个新的p命名空间，可以通过元素属性的方式配置Bean的属性。使用p命名空间后，基于XML的配置方式将进一步简化</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"studentSuper"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.helloworld.bean.Student"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">p:studentId</span>=<span class="string">"2002"</span> <span class="attr">p:stuName</span>=<span class="string">"Jerry2016"</span> <span class="attr">p:age</span>=<span class="string">"18"</span> /&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-2-可以使用的值"><a href="#2-2-可以使用的值" class="headerlink" title="2.2 可以使用的值"></a>2.2 可以使用的值</h3><ol>
<li><p>字面量</p>
<ul>
<li>可以使用字符串表示的值，可以通过value属性或value子节点的方式指定。</li>
<li>基本数据类型及其封装类、String等类型都可以采取字面值注入的方式。</li>
<li>若字面值中包含特殊字符，可以使用&lt;![CDATA[]]&gt;把字面值包裹起来。</li>
</ul>
</li>
<li><p>null值</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"username"</span> <span class="attr">value</span> =<span class="string">"zhangsan"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"age"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"email"</span> <span class="attr">value</span> =<span class="string">"123@qq.com"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span> &gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>外部已声明的bean</li>
<li>内部bean。当bean实例仅仅给一个特定的属性使用时，可以将其声明为内部bean。内部bean声明直接包含在或元素里，不需要设置任何id或name属性。内部bean不能使用在任何其他地方</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"Book"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>= <span class="string">"com.hgx98.bean.Book"</span> &gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"bookId"</span> <span class="attr">value</span> =<span class="string">"1000"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"bookName"</span> <span class="attr">value</span>=<span class="string">"innerBook"</span> /&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"author"</span> <span class="attr">value</span>=<span class="string">"innerAuthor"</span> /&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"price"</span> <span class="attr">value</span> =<span class="string">"50"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span> &gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-3-集合属性"><a href="#2-3-集合属性" class="headerlink" title="2.3 集合属性"></a>2.3 集合属性</h3><p><strong>在Spring中可以通过一组内置的XML标签来配置集合属性</strong></p>
<ol>
<li>数组和List<br>配置java.util.List类型的属性，需要指定标签，在标签里包含一些元素。这些标签可以通过指定简单的常量值，通过指定对其他Bean的引用。通过指定内置bean定义。通过指定空元素。甚至可以内嵌其他集合。<br> 数组的定义和List一样，都使用元素。<br> 配置java.util.Set需要使用标签，定义的方法与List一样。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Book"</span> <span class="attr">id</span>=<span class="string">"cprimerplus"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">value</span>=<span class="string">"xxx"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"C++ Primer Plus"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person02"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"马化腾"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"37"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"tencent@qq.com"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"bookList"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Book"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"HelloWorld"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">value</span>=<span class="string">"YourSelf"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"cprimerplus"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Map<br>Java.util.Map通过标签定义，标签里可以使用多个作为子标签。每个条目包含一个键和一个值。<br> 必须在标签里定义键。<br> 因为键和值的类型没有限制，所以可以自由地为它们指定《value》、《ref》、《bean》或《null/》元素。<br> 可以将Map的键和值作为的属性定义：简单常量使用key和value来定义；bean引用通过key-ref和value-ref属性定义。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person02"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"马化腾"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"37"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"tencent@qq.com"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"201412"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Properties<br>使用定义java.util.Properties，该标签使用多个作为子标签。每个标签必须定义key属性。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.DataSource"</span> <span class="attr">id</span>=<span class="string">"dataSource"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"properties"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"userName"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"password"</span>&gt;</span>201412<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"url"</span>&gt;</span>jdbc:mysql://localhost:3306/test?serverTimezone=GMT%2B8<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>charactorEncoding=utf-8<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"driverClass"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>集合类型的bean<br>如果只能将集合对象配置在某个bean内部，则这个集合的配置将不能重用。我们需要将集合bean的配置拿到外面，供其他bean引用。<br> 配置集合类型的bean需要引入util名称空间。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">"bookList"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"book01"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"book02"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"book03"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"book04"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"book05"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">"categoryList"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>编程<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>极客<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>相声<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>评书<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>对添加map组件进行修改：在外部定义一个map集合，然后通过id引用。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person02"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"马化腾"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"37"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"tencent@qq.com"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span> <span class="attr">ref</span>=<span class="string">"myMap"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">util:map</span> <span class="attr">id</span>=<span class="string">"myMap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"201412"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="3、bean的高级配置"><a href="#3、bean的高级配置" class="headerlink" title="3、bean的高级配置"></a>3、bean的高级配置</h2><h3 id="3-1-继承"><a href="#3-1-继承" class="headerlink" title="3.1 继承"></a>3.1 继承</h3><ul>
<li><p>parent：指定当前bean的配置信息继承于哪个id</p>
</li>
<li><p>用法：</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person01"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"马化腾"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"37"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"tencent@qq.com"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person02"</span> <span class="attr">parent</span>=<span class="string">"person01"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"马化腾"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Spring允许继承bean的配置，被继承的bean称为父bean。继承这个父bean的bean称为子bean。子bean从父bean中继承配置，包括bean的属性配置。子bean也可以覆盖从父bean继承过来的配置。</li>
<li>补充：<ul>
<li>父bean可以作为配置模板，也可以作为bean实例。若只想把父bean作为模板，可以设置的abstract 属性为true，这样Spring将不会实例化这个bean。</li>
<li>如果一个bean的class属性没有指定，则必须是抽象bean。</li>
<li>并不是元素里的所有属性都会被继承。比如：autowire，abstract等。</li>
<li>可以忽略父bean的class属性，让子bean指定自己的类，而共享相同的属性配置。但此时abstract必须设为true。</li>
</ul>
</li>
</ul>
<h3 id="3-2-bean之间的依赖"><a href="#3-2-bean之间的依赖" class="headerlink" title="3.2 bean之间的依赖"></a>3.2 bean之间的依赖</h3><p><strong>有的时候创建一个bean的时候需要保证另外一个bean也被创建，这时我们称前面的bean对后面的bean有依赖。例如：要求创建Employee对象的时候必须创建Department。这里需要注意的是依赖关系不等于引用关系，Employee即使依赖Department也可以不引用它。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"emp03"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Employee"</span> <span class="attr">depends-on</span>=<span class="string">"dept"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"empId"</span> <span class="attr">value</span>=<span class="string">"1003"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"empName"</span> <span class="attr">value</span>=<span class="string">"Kate"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"21"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-3-bean的作用域"><a href="#3-3-bean的作用域" class="headerlink" title="3.3 bean的作用域"></a>3.3 bean的作用域</h3><ul>
<li><p>在Spring中，可以在元素的scope属性里设置bean的作用域，以决定这个bean是单实例的还是多实例的。<br>  默认情况下，Spring只为每个在IOC容器里声明的bean创建唯一一个实例，整个IOC容器范围内都能共享该实例：所有后续的getBean()调用和bean引用都将返回这个唯一的bean实例。该作用域被称为singleton，它是所有bean的默认作用域。</p>
</li>
<li><p>bean的作用域默认是单实例（singleton）的</p>
<ul>
<li><p>prototype：多实例的</p>
<ol>
<li><p>容器启动默认不会去创建多实例bean。</p>
</li>
<li><p>获取的时候才会创建bean。</p>
</li>
<li><p>每次获取都会创建一个新的bean对象。</p>
</li>
</ol>
</li>
<li><p>singleton：单实例的</p>
<ol>
<li><p>在容器启动完成之前就已经创建好对象保存在容器中了。</p>
</li>
<li><p>任何获取都是获取之前创建好的那个对象。</p>
</li>
</ol>
</li>
<li><p><del>request：在web环境下，同一次请求创建一个Bean实例</del></p>
</li>
<li><p><del>session：在web环境下，同一次回话创建一个Bean实例</del></p>
</li>
</ul>
</li>
</ul>
<p><img src="/2020/05/24/Spring/image-20200524164731869.png" alt="image-20200524164731869"></p>
<ul>
<li>当bean的作用域为单例时，Spring会在IOC容器对象创建时就创建bean的对象实例。而当bean的作用域为prototype时，IOC容器在获取bean的实例时创建bean的实例对象。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person01"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"马化腾"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"37"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"tencent@qq.com"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-4-bean的生命周期"><a href="#3-4-bean的生命周期" class="headerlink" title="3.4 bean的生命周期"></a>3.4 bean的生命周期</h3><ul>
<li>Spring IOC容器可以管理bean的生命周期，Spring允许在bean生命周期内特定的时间点执行指定的任务。</li>
<li>Spring IOC容器对bean的生命周期进行管理的过程：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 通过构造器或工厂方法创建bean实例</span><br><span class="line">2. 为bean的属性设置值和对其他bean的引用</span><br><span class="line">3. 调用bean的初始化方法</span><br><span class="line">4. bean可以使用了</span><br><span class="line">5. 当容器关闭时，调用bean的销毁方法</span><br></pre></td></tr></table></figure>

<ul>
<li>在配置bean时，通过init-method和destroy-method 属性为bean指定初始化和销毁方法。</li>
<li>bean的后置处理器。Spring有一个接口：后置处理器（BeanPostProcessor），可以在bean的初始化前后调用方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPostProcessorImpl</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        初始化之前调用</span></span><br><span class="line"><span class="comment">        Object bean：将要初始化的bean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(beanName + <span class="string">"要调用初始化方法了"</span>);</span><br><span class="line">        <span class="keyword">return</span> beanName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        初始化方法之后调用</span></span><br><span class="line"><span class="comment">        String beanName：bean在xml中配置的id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(beanName + <span class="string">"bean初始化方法调用完了"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. bean后置处理器允许在调用初始化方法前后对bean进行额外的处理</span><br><span class="line">2. bean后置处理器对IOC容器里的所有bean实例逐一处理，而非单一实例。其典型应用是：检查bean属性的正确性或根据特定的标准更改bean的属性。</span><br><span class="line">3. bean后置处理器时需要实现接口：org.springframework.beans.factory.config.BeanPostProcessor。在初始化方法被调用前后，Spring将把每个bean实例分别传递给上述接口的以下两个方法：</span><br><span class="line">	- postProcessBeforeInitialization(Object, String)</span><br><span class="line">	- postProcessAfterInitialization(Object, String)</span><br></pre></td></tr></table></figure>

<ul>
<li>添加bean后置处理器后bean的生命周期</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. 通过构造器或工厂方法创建bean实例</span><br><span class="line">2. 为bean的属性设置值和对其他bean的引用</span><br><span class="line">3. 将bean实例传递给bean后置处理器的postProcessBeforeInitialization()方法</span><br><span class="line">4. 调用bean的初始化方法</span><br><span class="line">5. 将bean实例传递给bean后置处理器的postProcessAfterInitialization()方法</span><br><span class="line">6. bean可以使用了</span><br><span class="line">7. 当容器关闭时调用bean的销毁方法</span><br></pre></td></tr></table></figure>



<h3 id="3-5-引用外部属性文件"><a href="#3-5-引用外部属性文件" class="headerlink" title="3.5 引用外部属性文件"></a>3.5 引用外部属性文件</h3><p><strong>当bean的配置信息逐渐增多时，查找和修改一些bean的配置信息就变得愈加困难。这时可以将一部分信息提取到bean配置文件的外部，以properties格式的属性文件保存起来，同时在bean的配置文件中引用properties属性文件中的内容，从而实现一部分属性值在发生变化时仅修改properties属性文件即可。这种技术多用于连接数据库的基本信息的配置。</strong></p>
<p>以数据库连接池为例。</p>
<ol>
<li>直接配置</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/book_store?serverTimezone=GMT%2B8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"201412"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>通过引用外部的属性文件</p>
<ol>
<li><p>创建properties属性文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/book_store?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="comment"># 此处代表用户名字的标识符不能写成username，因为username是Spring中的一个关键字</span></span><br><span class="line"><span class="comment"># username=root</span></span><br><span class="line"><span class="attr">user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">201412</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>引入context名称空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context="http://www.springframework.org/schema/context"</span><br><span class="line"></span><br><span class="line">xsi:schemaLocation="</span><br><span class="line">	   ...</span><br><span class="line">       http://www.springframework.org/schema/context</span><br><span class="line">       http://www.springframework.org/schema/context/spring-context-2.5.xsd"</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定properties属性文件的位置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:dbconfig.properties"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>从properties属性文件中引入属性值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context  </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context-2.5.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--加载外部配置文件，固定写法：classpath：表示引用类路径下的一个资源--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--只要加载了外部配置文件，就可以通过$&#123;&#125;来取出配置文件中的value值了--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:dbconfig.properties"</span>/&gt;</span></span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		此处若是value="$&#123;username&#125;"则会将Spring中的username取出来，而不是将dbconfig.properties</span></span><br><span class="line"><span class="comment">		中的username取出，因为username是Spring的一个关键字，所以需要更改标识符为user</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;user&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;driverClassName&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
</li>
</ol>
<h3 id="3-6-自动装配"><a href="#3-6-自动装配" class="headerlink" title="3.6 自动装配"></a>3.6 自动装配</h3><ol>
<li><p>自动装配的概念</p>
<ul>
<li>手动装配：以value或ref的方式明确指定属性值都是手动装配。</li>
<li>自动装配：根据指定的装配规则，不需要明确指定，Spring自动将匹配的属性值注入bean中。</li>
</ul>
</li>
<li><p>装配模式</p>
<ul>
<li>autowire=”default / no”：不自动装配</li>
<li>autowire=”byName”：按照名字自动装配：在Person类中有一个属性（private Car car），autowire=”byName”可以根据类中的属性名（car）作为id去ioc容器中找到这个组件，给Person的对象赋值，如果找不到则为其装配null。该方式必须将目标bean的名称和属性名设置的完全相同。</li>
<li>autowire=”byType”：以属性的类型（Car）作为依据去ioc容器中找组件，找不到则为其装配null。若IOC容器中有多个与目标bean类型一致的bean，Spring将无法判定哪个bean最合适该属性，所以不能执行自动装配。</li>
<li>autowire=”constructor”：按照构造器进行自动装配。先按照Person类中的有参构造器进行装配，如果成功则装配，没有则装配null。如果按照类型找到了多个组件，那么将参数的名字（car）作为id继续匹配，如果依然找不到组件则装配null。这种自动装配方式不会报错。当bean中存在多个构造器时，此种自动装配方式将会很复杂。不推荐使用。</li>
</ul>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--如果此处的id不是car而是其他名字，那么通过autowire="byName"则不能给Person进行自动装配--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果用的是autowire="byType"，那么此处的id则没有任何要求，自动装配会根据类型（class）来找组件，但是如果该类型的组件多于一个，那么自动装配则会报错--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Car"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"carName"</span> <span class="attr">value</span>=<span class="string">"bwm"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">value</span>=<span class="string">"1023222"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car01"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Car"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"carName"</span> <span class="attr">value</span>=<span class="string">"benz"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">value</span>=<span class="string">"2000000"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">autowire</span>=<span class="string">"constructor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-7-通过abstract创建一个模板bean"><a href="#3-7-通过abstract创建一个模板bean" class="headerlink" title="3.7 通过abstract创建一个模板bean"></a>3.7 通过abstract创建一个模板bean</h3><ul>
<li>在bean标签中加入<code>abstract=&quot;true&quot;</code>，则将person01设置为一个抽象的组件。不能获取该组件的实例，该组件只能被别人用来继承。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span> <span class="attr">id</span>=<span class="string">"person01"</span> <span class="attr">abstract</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"马化腾"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"37"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"tencent@qq.com"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="4、静态工厂与实例工厂"><a href="#4、静态工厂与实例工厂" class="headerlink" title="4、静态工厂与实例工厂"></a>4、静态工厂与实例工厂</h2><ul>
<li><p>bean的创建默认就是框架利用反射new出来的bean实例。</p>
</li>
<li><p>工厂模式：工厂帮我们创建对象，有一个专门创建对象的类，这个类就是工厂。</p>
</li>
<li><p>静态工厂：工厂本身不用创建对象，通过静态方法调用：<br>对象 = 工厂类.工厂方法名();</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"对象名"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.factory.xxxxxxStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"xxxx"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">consrtuctor-arg</span> <span class="attr">name</span>=<span class="string">"xxx"</span> <span class="attr">value</span>=<span class="string">"xxx"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">consrtuctor-arg</span> <span class="attr">name</span>=<span class="string">"xxx"</span> <span class="attr">value</span>=<span class="string">"xxx"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>class：指定静态工厂全类名。</p>
<p>factory-method：指定工厂方法。</p>
<p>constructor-arg：可以为方法传参。</p>
<ul>
<li><p>实例工厂：工厂本身需要创建对象：</p>
<ul>
<li>工厂类 工厂对象 = new 工厂类();<br>工厂对象.getxxx();</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--factory-method：指定这个实例工厂中哪个方法是工厂方法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"method01"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.factory.xxxxInstanceFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    factory-bean：指定当前对象的创建使用哪个工厂</span></span><br><span class="line"><span class="comment">    1. 先配置出实例工厂对象</span></span><br><span class="line"><span class="comment">	   &lt;bean id="method01" class="com.hgx98.factory.xxxxInstanceFactory"&gt;&lt;/bean&gt;</span></span><br><span class="line"><span class="comment">    2. 配置要创建的对象使用哪个工厂创建</span></span><br><span class="line"><span class="comment">		1) factory-bean：指定使用哪个工厂实例</span></span><br><span class="line"><span class="comment">		2) factory-method：使用哪个工厂方法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"对象名"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.对象类型"</span> <span class="attr">factory-bean</span>=<span class="string">"method01"</span> <span class="attr">factory-method</span>=<span class="string">"xxxx"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">consrtuctor-arg</span> <span class="attr">name</span>=<span class="string">"xxx"</span> <span class="attr">value</span>=<span class="string">"xxx"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">consrtuctor-arg</span> <span class="attr">name</span>=<span class="string">"xxx"</span> <span class="attr">value</span>=<span class="string">"xxx"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>FactoryBean是Spring规定的一个接口，只要是这个接口的实现类，Spring都认为其是一个工厂。</p>
<ol>
<li><p>编写一个FactoryBean的实现类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    实现了FactoryBean接口的类是Spring可以认识的工厂类</span></span><br><span class="line"><span class="comment">    Spring会自动的调用工厂方法创建实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFactoryBeanImpl</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Book</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 返回创建的对象 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setTitle(UUID.randomUUID().toString());</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        返回创建的对象的类型</span></span><br><span class="line"><span class="comment">        Spring会自动调用这个方法来确认创建的对象是什么类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Book<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 是单例对象吗？ */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在Spring配置文件中进行注册</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myFactoryBeanImpl"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.factory.MyFactoryBeanImpl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>注意：FactoryBean接口的实现类不管是单实例还是多实例，都是在获取的时候才创建对象，而不是容器启动之前创建对象。</p>
</li>
</ul>
<h2 id="5、SpEL"><a href="#5、SpEL" class="headerlink" title="5、SpEL"></a>5、SpEL</h2><p>SpEL：Spring Expression Language，Spring表达式语言，支持运行时查询并可以操作对象图。SpEL使用#{…}作为定界符，所有在大框号中的字符都将被认为是SpEL表达式。</p>
<ul>
<li>SpEL支持所有的运算符<ul>
<li>算术运算符：+、-、*、/、%、^</li>
<li>字符串连接：+</li>
<li>比较运算符：&lt;、&gt;、==、&lt;=、&gt;=、lt、gt、eq、le、ge</li>
<li>逻辑运算符：and, or, not, |</li>
<li>三目运算符：判断条件 ? 判断结果为 true 时的取值 : 判断结果为 false 时的取值</li>
<li>正则表达式：matches</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book01"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Book"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"bookName"</span> <span class="attr">value</span>=<span class="string">"Cplus"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car01"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Car"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"carName"</span> <span class="attr">value</span>=<span class="string">"bwm"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">value</span>=<span class="string">"1023222"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.hgx98.bean.Person"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 字面量，$&#123;&#125;, #&#123;&#125; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"#&#123;12 * 5&#125;"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 将book01的 bookName 赋给 lastName --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">value</span>=<span class="string">"#&#123;book01.bookName&#125;"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 引用其他bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">value</span>=<span class="string">"#&#123;car01&#125;"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		调用静态方法 </span></span><br><span class="line"><span class="comment">		格式：#&#123;T(静态类全类名).静态方法名(参数)&#125;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"#&#123;T(java.util.UUID).randomUUID().toString().subString(0, 5)&#125;"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 调用非静态方法：对象.方法名() --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"#&#123;book01.getBookName()&#125;"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="6、通过注解创建Dao、service、Controller"><a href="#6、通过注解创建Dao、service、Controller" class="headerlink" title="6、通过注解创建Dao、service、Controller"></a>6、通过注解创建Dao、service、Controller</h2><p><strong>通过给bean上添加某些注解，可以快速地将bean加入到IOC容器中。</strong></p>
<p>Spring有四个注解：</p>
<ul>
<li>@Controller：控制器。推荐给控制器层（servlet包下的）的组件加该注解</li>
<li>@Service：业务逻辑。推荐业务逻辑层的组件添加这个注解</li>
<li>@Repository：推荐给数据库层（持久化层：Dao层）添加这个注解。</li>
<li>@Component：推荐给不属于以上层的组件添加这个注解。</li>
</ul>
<p>在某个类上添加<strong>任何一个</strong>注解都能快速地将这个组件加入到IOC容器中。 因为事实上Spring并没有能力识别一个组件到底是不是它所标记的类型，即使将@Respository注解用在一个表述层控制器组件上面也不会产生任何错误，所以@Respository、@Service、@Controller这几个注解仅仅是为了让开发人员自己明确当前的组件扮演的角色。</p>
<hr>
<p><strong>使用注解将组件快速地加入到容器中需要几步：</strong></p>
<ol>
<li>给要添加的组件上添加注解。（@Controller、@Service、@Repository、@Component）</li>
<li>告诉Spring自动扫描加了注解的组件。该操作依赖于context名称空间：context:component-scan。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- base-package：指定扫描的基础包，把基础包及其包下所有添加了注解的组件都添加到容器中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.hgx98"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>导入aop包。该包支持Spring 的注解模式。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring-aop-4.0.0.RELEASE.jar</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>使用注解加入到容器中的组件和使用配置加入到容器中的组件，行为都是默认一样的：</strong></p>
<ol>
<li>组件的id，默认就是组件的类名首字母小写。如果要修改，则可以：@Controller(“别名”)</li>
<li>组件的作用域默认就是单例的。如果要修改为多实例，可以在bean上添加注解@Scope(value=”prototype”)</li>
</ol>
<hr>
<p><strong>包含与排除</strong></p>
<ul>
<li><p>context:include-filter：扫描的时候只扫描哪些组件。默认是全部扫描。一定要禁用掉默认的过滤规则才可以有效使用。</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 只扫描添加了@Controller注解的bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.hgx98"</span> <span class="attr">use-default-filters</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>context:exclude-filter：扫描的时候可以排除一些不需要的组件。</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	type="annotation"可以指定排除规则为按照注解进行排除。标注了指定注解的组件不要</span></span><br><span class="line"><span class="comment">	expression=""：注解的全类名</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	type="assignable"：指定排除某个具体的类。按照类排除。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	------ 以下三种不常用到 ------</span></span><br><span class="line"><span class="comment">	type="custom"</span></span><br><span class="line"><span class="comment">	type="aspectj"</span></span><br><span class="line"><span class="comment">	type="regex"</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--标注了@Controller注解的bean会被排除，不加入到容器中--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.hgx98"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--BookServlet这个类被排除，不会加入到容器中--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.hgx98"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"assignable"</span> <span class="attr">expression</span>=<span class="string">"com.hgx98.servlet.BookServlet"</span>/&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>component-scan下可以拥有若干个include-filter和exclude-filter子节点。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">类别</th>
<th align="center">实例</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">annotation</td>
<td align="center">com.hgx98.XxxAnnotation</td>
<td align="center">过滤所有标注了XxxAnnotation的类。这个规则根据目标组件是否标注了指定类型的注解进行过滤</td>
</tr>
<tr>
<td align="center">assignable</td>
<td align="center">com.hgx98.BaseXxx</td>
<td align="center">过滤了所有BaseXxx的子类，这个规则根据目标组件是否是指定类型的子类的方式进行过。</td>
</tr>
<tr>
<td align="center">aspectj</td>
<td align="center">com.hgx98.*Service</td>
<td align="center">所有类名是以Service结束的，或这样的类的子类。这个规则根据AspectJ表达式进行过滤</td>
</tr>
<tr>
<td align="center">regex</td>
<td align="center">com\.hgx98\.anno\.*</td>
<td align="center">所有com.hgx98.anno包下的类。这个规则根据正则表达式匹配到的类名进行过滤</td>
</tr>
<tr>
<td align="center">custom</td>
<td align="center">com.hgx98.XxxTypeFilter</td>
<td align="center">使用XxxTypeFilter类通过编码的方式自定义过滤规则。该类必须实现org.springframework.core.type.filter.TypeFilter接口</td>
</tr>
</tbody></table>
<hr>
<p><strong>组件匹配</strong><br>        Controller组件中往往需要用到Service组件的实例，Service组件中往往需要用到Repository组件的实例。Spring可以通过注解的方式帮我们实现属性的装配，具体实现依据如下：<br>        在指定要扫描的包时，context:component-scan元素会自动注册一个bean的后置处理器：AutowiredAnnotationBeanPostProcessor的实例。该后置处理器可以自动装配标记了<strong>@Autowired</strong>、<strong>@Resource</strong>或<strong>@Inject</strong>注解的属性。</p>
<hr>
<p><strong>@Autowired</strong>、<strong>@Resource</strong>与<strong>@Inject</strong></p>
<ul>
<li><p><strong>@Autowired</strong></p>
<ol>
<li>根据类型实现自动装配。</li>
<li>构造器、普通字段（即使是非public）、一切具有参数的方法都可以应用该注解。</li>
<li>默认情况下，所有使用该注解的属性都需要被设置。当Spring找不到匹配的bean装配属性时，会跑出异常。</li>
<li>若某一属性允许不被设置，可以设置该注解的required属性为false。</li>
<li>默认情况下，当IoC容器里存在多个类型兼容的bean时，Spring会尝试匹配bean的id值是否与变量名相同，如果相同则进行装配。如果bean的id值不同，通过类型的自动装配将无法工作。此时可以在@Qualifier注解里提供bean的名称。Spring甚至允许在方法的形参上标注@Qualifiter注解以指定注入bean的名称。</li>
<li>@Autowired注解也可以应用在数组类型的属性上，此时Spring将会把所有匹配的bean进行自动装配。</li>
<li>@Autowired注解也可以应用在集合属性上，此时Spring读取该集合的类型信息，然后自动装配所有与之兼容的bean。</li>
<li>@Autowired注解用在java.util.Map上时，若该Map的键值为String，那么<br> Spring将自动装配与值类型兼容的bean作为值，并以bean的id值作为键。</li>
</ol>
</li>
<li><p>@Resource</p>
<p>  @Resource注解要求提供一个bean名称的属性，若该属性为空，则自动采用标注处的变量或方法名作为bean的名称。</p>
</li>
<li><p>@Inject</p>
<p>  @Inject和@Autowired注解一样也是按类型注入匹配的bean，但没有reqired属性。</p>
</li>
<li><p><strong>@Resource与@autowired的区别：@Resource的可扩展性更加强大，它是基于Java本身实现的，而@autowired的使用只是基于spring框架，即@Resource 由jdk提供@Autowired由spring提供。</strong></p>
</li>
</ul>
<h2 id="7、DI（依赖注入）"><a href="#7、DI（依赖注入）" class="headerlink" title="7、DI（依赖注入）"></a>7、DI（依赖注入）</h2><p>​        <strong>IoC的一个重点是在系统运行中，动态的向某个对象提供它所需要的其他对象。这一点是通过DI（Dependency Injection，依赖注入）来实现的</strong>。比如对象A需要操作数据库，以前我们总是要在A中自己编写代码来获得一个Connection对象，有了 spring我们就只需要告诉spring，A中需要一个Connection，至于这个Connection怎么构造，何时构造，A不需要知道。在系统运行时，spring会在适当的时候制造一个Connection，然后像打针一样，注射到A当中，这样就完成了对各个对象之间关系的控制。A需要依赖 Connection才能正常运行，而这个Connection是由spring注入到A中的，依赖注入的名字就这么来的。那么DI是如何实现的呢？ Java 1.3之后一个重要特征是反射（reflection），它允许程序在运行的时候动态的生成对象、执行对象的方法、改变对象的属性，spring就是通过反射来实现注入的。</p>
<ul>
<li><strong>Spring是如何实现发现bean并加入到容器当中的？</strong><br>Spring解析bean加载到容器当中主要有以下几步：</li>
</ul>
<ol>
<li>在xml文件里定义bean的信息；<ol start="2">
<li>使用dom4j技术解析xml文件-&gt;拿到类名-&gt;使用反射技术创建类对应的class对象；</li>
<li>使用反射技术-根据类对象创建实例对象；</li>
<li>设计模式的工厂模式。</li>
</ol>
</li>
</ol>
<ul>
<li>从整体来看，解析和创建类对象的代码是放在一个统一的地方管理的，在这里使用了工厂模式。<br>当我们改变对象时，只需要xml文件作出适当的改变就好了，剩余都交给了spring处理，即交给了工厂处理。好处是：</li>
</ul>
<ol>
<li>降低了类之间的耦合度；<ol start="2">
<li>易于统一修改和维护；</li>
<li>符合了开放封闭原则，迪米特法则。只依赖产品类的抽象，符合依赖倒置原则。使用产品子类替换产品父类，也符合里氏替换原则；</li>
<li>分离了对象的创建和使用。</li>
</ol>
</li>
</ol>
<ul>
<li><strong>Spring是如何通过反射实现依赖注入的？</strong><br>假设有如下代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApp</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"BeansIOCConstructor.xml"</span>);</span><br><span class="line"> </span><br><span class="line">        TextEditor te = (TextEditor) context.getBean(<span class="string">"textEditor"</span>);</span><br><span class="line"> </span><br><span class="line">        te.spellCheck();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>        在这里xml文件里面到底是setter注入还是构造方法注入，我们根本就无需关心，这些类怎么定义的我们也不去关心，就只看这个运行类。这个运行类不就是想做一件事情：调用TextEditor 这个类的spellCheck方法吗？那自然我们就需要这个类的一个bean对象，既然Spring容器帮我们管理了这个对象，于是我们就不通过关键字new，而是通过spring去获得这个对象，怎么获得的呢？在xml文件里必然定义了这个类的相关信息，其中class的全限定名是必须定义的，**为什么要定义全限定名，自然就是因为Spring要帮我们加载这个类，只能是利用反射机制，根据这个类的全限定名称，才能够做到动态的去加载这个类（联系Class.forName方法理解）**。加载了之后，通过这里的getBean方法去获得这个类的对象，就可以去调用它的方法了。至于别的可以配的参数，我们现在根本无需关心。
以上就是spring通过反射实现依赖注入的思想。
​    </code></pre><ul>
<li><p><strong>不使用xml，而使用注解@Autowired注入一个bean，Spring是如何实现的？</strong><br>  事实上每一个注解本质上都是一个接口，当我们在某一个类当中用到这个注解的时候，就可以通过反射知道是哪个类用了这个注解。也就能拿到这个类的类名，然后就可以根据类名使用反射机制创建对象。与xml的方式就是一样了。大致步骤如下:</p>
<ol>
<li>利用反射机制获取一个类的Class对象</li>
<li>通过这个class对象可以去获取他的每一个字段Field</li>
<li>Field类提供了方法getDeclaredAnnotations来获取这个一个字段的所有注解。</li>
</ol>
</li>
</ul>
<h1 id="二、AOP"><a href="#二、AOP" class="headerlink" title="二、AOP"></a>二、AOP</h1><h2 id="1、AOP概述"><a href="#1、AOP概述" class="headerlink" title="1、AOP概述"></a>1、AOP概述</h2><ul>
<li>AOP(Aspect-Oriented Programming，面向切面编程)：是一种新的方法论，是对传统 OOP(Object-Oriented Programming，面向对象编程)的补充。可在程序运行期间，将某段代码<strong>动态地</strong>切入到<strong>指定方法的指定位置</strong>进行运行的编程方式。</li>
<li>AOP编程操作的主要对象是切面(aspect)，而切面模块化横切关注点。</li>
<li>在应用AOP编程时，仍然需要定义公共功能，但可以明确的定义这个功能应用在哪里，以什么方式应用，并且不必修改受影响的类。这样一来横切关注点就被模块化到特殊的类里——这样的类我们通常称之为“切面”。</li>
<li>AOP的好处：<ul>
<li>每个事物逻辑位于一个位置，代码不分散，便于维护和升级</li>
<li>业务模块更简洁，只包含核心业务代码</li>
</ul>
</li>
</ul>
<p><img src="/2020/05/24/Spring/image-20200524205418172.png" alt="image-20200524205418172"></p>
<h2 id="2、AOP术语"><a href="#2、AOP术语" class="headerlink" title="2、AOP术语"></a>2、AOP术语</h2><ul>
<li><p><strong>横切关注点：</strong>从每个方法中抽取出来的同一类非核心业务。</p>
</li>
<li><p><strong>切面（Aspect）：</strong>封装横切关注点信息的类，每个关注点体现为一个通知方法。</p>
</li>
<li><p><strong>通知（Advice）：</strong>切面必须要完成的各个具体工作</p>
</li>
<li><p><strong>目标（Target）：</strong>被通知的对象</p>
</li>
<li><p><strong>代理（Proxy）：</strong>向目标对象应用通知之后创建的代理对象</p>
</li>
<li><p><strong>连接点（Joinpoint）：</strong>横切关注点在程序代码中的具体体现，对应程序执行的某个特定位置。例如：类某个方法调用前、调用后、方法捕获到异常后等。</p>
</li>
</ul>
<p><strong>在应用程序中可以使用横纵两个坐标来定位一个具体的连接点：</strong></p>
<p><img src="/2020/05/24/Spring/image-20200524205737181.png" alt="image-20200524205737181"></p>
<ul>
<li><strong>切入点(pointcut)：</strong>定位连接点的方式。每个类的方法中都包含多个连接点，所以连接点是类中客观存在的事物。如果把连接点看作数据库中的记录，那么切入点就是查询条件——AOP可以通过切入点定位到特定的连接点。切点通过org.springframework.aop.Pointcut 接口进行描述，它使用类和方法作为连接点的查询条件。</li>
</ul>
<h2 id="3、AspectJ"><a href="#3、AspectJ" class="headerlink" title="3、AspectJ"></a>3、AspectJ</h2><h3 id="3-1-简介"><a href="#3-1-简介" class="headerlink" title="3.1 简介"></a>3.1 简介</h3><ul>
<li>AspectJ是Java社区里最完整最流行的AOP框架。</li>
<li>在Spring2.0以上版本中，可以使用基于AspectJ注解或基于XML配置的AOP。</li>
</ul>
<h3 id="3-2-在Spring中启用AspectJ注解支持"><a href="#3-2-在Spring中启用AspectJ注解支持" class="headerlink" title="3.2 在Spring中启用AspectJ注解支持"></a>3.2 在Spring中启用AspectJ注解支持</h3><ol>
<li><p>导入相关jar包</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aopalliance-1.0.jar</span><br><span class="line">aspectjweaver-1.9.5.jar</span><br><span class="line">cglib-3.3.0.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>引入aop名称空间</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.springframework.org/schema/aop</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context-2.5.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 当Spring IOC容器侦测到bean配置文件中的&lt;aop:aspectj-autoproxy/&gt;元素时，会自动为与AspectJ切面匹配的bean创建代理。</p>
</li>
</ol>
<h3 id="3-3-用AspectJ注解声明切面"><a href="#3-3-用AspectJ注解声明切面" class="headerlink" title="3.3 用AspectJ注解声明切面"></a>3.3 用AspectJ注解声明切面</h3><ol>
<li><p>要在Spring中声明AspectJ切面，只需要在IOC容器中将切面声明为bean实例。</p>
</li>
<li><p>当在Spring IOC容器中初始化AspectJ切面之后，Spring IOC容器就会为那些与 AspectJ切面相匹配的bean创建代理。</p>
</li>
<li><p>在AspectJ注解中，切面只是一个带有@Aspect注解的Java类，它往往要包含很多通知。</p>
</li>
<li><p>通知是标注有某种注解的简单的Java方法。</p>
</li>
<li><p>AspectJ支持5种类型的通知注解：</p>
<ul>
<li><p>@Before：前置通知，在方法执行之前执行。</p>
</li>
<li><p>@After：后置通知，后置通知是在连接点完成之后执行的，即连接点返回结果或者抛出异常的时候。</p>
</li>
<li><p>@AfterRunning：返回通知，无论连接点是正常返回还是抛出异常，后置通知都会执行。如果只想在连接点返回的时候记录日志，应使用返回通知代替后置通知。在返回通知中，只要将returning属性添加到@AfterReturning注解中，就可以访问连接点的返回值。该属性的值即为用来传入返回值的参数名称。必须在通知方法的签名中添加一个同名参数。在运行时Spring AOP会通过这个参数传递返回值。原始的切点表达式需要出现在pointcut / value属性中。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterReturning</span>(value = <span class="string">"execution(public int com.hgx98.bean.CalculatorImpl.*(int, int))"</span>, returning = <span class="string">"result"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">logReturn</span><span class="params">(JoinPoint joinPoint, Object result)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"["</span> + format.format(<span class="keyword">new</span> Date().getTime()) + <span class="string">"] "</span> + joinPoint.getSignature().getName() + Arrays.asList(joinPoint.getArgs()) +  <span class="string">" 方法执行完成，返回值为: "</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>@AfterThrowing：异常通知，只在连接点抛出异常时才执行异常通知。将throwing属性添加到@AfterThrowing注解中，也可以访问连接点抛出的异常。Throwable是所有错误和异常类的顶级父类，所以在异常通知方法可以捕获到任何错误和异常。如果只对某种特殊的异常类型感兴趣，可以将参数声明为其他异常的参数类型。然后通知就只在抛出这个类型及其子类的异常时才被执行。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing</span>(value = <span class="string">"execution(public int com.hgx98.bean.CalculatorImpl.*(int, int))"</span>, throwing = <span class="string">"e"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">logException</span><span class="params">(JoinPoint joinPoint, Exception e)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"["</span> + format.format(<span class="keyword">new</span> Date().getTime()) + <span class="string">"] "</span> + joinPoint.getSignature().getName() + Arrays.asList(joinPoint.getArgs()) +  <span class="string">" 方法出现异常: "</span> + e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>@Around：环绕通知，环绕通知是所有通知类型中功能最为强大的，能够全面地控制连接点，甚至可以控制是否执行连接点。对于环绕通知来说，连接点的参数类型必须是ProceedingJoinPoint。它是 JoinPoint的子接口，允许控制何时执行，是否执行连接点。<br>  在环绕通知中需要明确调用ProceedingJoinPoint的proceed()方法来执行被代理的方法。如果忘记这样做就会导致通知被执行了，但目标方法没有被执行。 <strong>注意：环绕通知的方法需要返回目标方法执行之后的结果，即调用 joinPoint.proceed();的返回值，否则会出现空指针异常。</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@After</span>(<span class="string">"execution(public int com.hgx98.bean.CalculatorImpl.*(int, int))"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">logEnd</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"["</span> + format.format(<span class="keyword">new</span> Date().getTime()) + <span class="string">"] "</span> + joinPoint.getSignature().getName() + Arrays.asList(joinPoint.getArgs()) +  <span class="string">" 方法结束"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ol>
<h3 id="3-4-切入点表达式"><a href="#3-4-切入点表达式" class="headerlink" title="3.4 切入点表达式"></a>3.4 切入点表达式</h3><ul>
<li>语法格式：<strong>execution([权限修饰符] [返回值类型] [简单类名/全类名] [方法名])</strong></li>
<li>在AspectJ中，切入点表达式可以通过 “&amp;&amp;”、“||”、“!”等操作符结合起来。<br>  表达式 execution (* <em>.add(int,…)) || execution(</em> *.sub(int,…))<br>  含义 任意类中第一个参数为int类型的add方法或sub方法</li>
</ul>
<h3 id="3-5-实际应用"><a href="#3-5-实际应用" class="headerlink" title="3.5 实际应用"></a>3.5 实际应用</h3><p><img src="/2020/05/24/Spring/image-20200524211615779.png" alt="image-20200524211615779"></p>
<h3 id="3-6-当前连接点细节"><a href="#3-6-当前连接点细节" class="headerlink" title="3.6 当前连接点细节"></a>3.6 当前连接点细节</h3><p><strong>切入点表达式通常都会是从宏观上定位一组方法，和具体某个通知的注解结合起来就能够确定对应的连接点。那么就一个具体的连接点而言，我们可能会关心这个连接点的一些具体信息，例如：当前连接点所在方法的方法名、当前传入的参数值等等。这些信息都封装在JoinPoint接口的实例对象中。</strong></p>
<p><img src="/2020/05/24/Spring/image-20200524211810150.png" alt="image-20200524211810150"></p>
<h3 id="3-7-重用切入点定义"><a href="#3-7-重用切入点定义" class="headerlink" title="3.7 重用切入点定义"></a>3.7 重用切入点定义</h3><p>在编写AspectJ切面时，可以直接在通知注解中书写切入点表达式。但同一个切点表达式可能会在多个通知中重复出现。<br>在AspectJ切面中，可以通过@Pointcut注解将一个切入点声明成简单的方法。<br>切入点的方法体通常是空的，因为将切入点定义与应用程序逻辑混在一起是不合理的。<br>切入点方法的访问控制符同时也控制着这个切入点的可见性。<br>如果切入点要在多个切面中共用，最好将它们集中在一个公共的类中。在这种情况下，它们必须被声明为public。<br>在引入这个切入点时，必须将类名也包括在内。如果类没有与这个切面放在同一个包中，还必须包含包名。其他通知可以通过方法名称引入该切入点</p>
<p><img src="/2020/05/24/Spring/image-20200524215133198.png" alt="image-20200524215133198"></p>
<h3 id="3-8-指定切面的优先级"><a href="#3-8-指定切面的优先级" class="headerlink" title="3.8 指定切面的优先级"></a>3.8 指定切面的优先级</h3><p>在同一个连接点上应用不止一个切面时，除非明确指定，否则它们的优先级是不确定的。 切面的优先级可以通过实现Ordered接口或利用@Order注解指定。 实现Ordered接口，getOrder()方法的返回值越小，优先级越高。 若使用@Order注解，序号出现在注解中。</p>
<h2 id="4、AOP以xml方式配置切面"><a href="#4、AOP以xml方式配置切面" class="headerlink" title="4、AOP以xml方式配置切面"></a>4、AOP以xml方式配置切面</h2><h3 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4.1 概述"></a>4.1 概述</h3><p>​        除了使用AspectJ注解声明切面，Spring也支持在bean配置文件中声明切面。这种声明是通过aop名称空间中的XML元素完成的。正常情况下，基于注解的声明要优先于基于XML的声明。通过AspectJ注解，切面可以与AspectJ兼容，而基于XML的配置则是Spring专有的。由于AspectJ得到越来越多的 AOP框架支持，所以以注解风格编写的切面将会有更多重用的机会。</p>
<h3 id="4-2-配置细节"><a href="#4-2-配置细节" class="headerlink" title="4.2 配置细节"></a>4.2 配置细节</h3><p>​        在bean配置文件中，所有的Spring AOP配置都必须定义在&lt;aop:config&gt;元素内部。对于每个切面而言，都要创建一个&lt;aop:aspect&gt;元素来为具体的切面实现引用后端bean实例。切面bean必须有一个标识符，供&lt;aop:aspect&gt;元素引用。</p>
<p><img src="/2020/05/24/Spring/image-20200524220053438.png" alt="image-20200524220053438"></p>
<h3 id="4-3-声明切入点"><a href="#4-3-声明切入点" class="headerlink" title="4.3 声明切入点"></a>4.3 声明切入点</h3><p>切入点使用&lt;aop:pointcut&gt;元素声明。<br>切入点必须定义在&lt;aop:aspect&gt;元素下，或者直接定义在&lt;aop:config&gt;元素下。<br>定义在&lt;aop:aspect&gt;元素下：只对当前切面有效。<br>定义在&lt;aop:config&gt;元素下：对所有切面都有效。<br>基于XML的AOP配置不允许在切入点表达式中用名称引用其他切入点。</p>
<p><img src="/2020/05/24/Spring/image-20200524220258855.png" alt="image-20200524220258855"></p>
<h3 id="4-4-声明通知"><a href="#4-4-声明通知" class="headerlink" title="4.4 声明通知"></a>4.4 声明通知</h3><p>​        在aop名称空间中，每种通知类型都对应一个特定的XML元素。 通知元素需要使用&lt;pointcut-ref&gt;来引用切入点，或用&lt;pointcut&gt;直接嵌入切入点表达式。 method属性指定切面类中通知方法的名称。</p>
<p><img src="/2020/05/24/Spring/image-20200524220459086.png" alt="image-20200524220459086"></p>
<h2 id="5、JdbcTemplate"><a href="#5、JdbcTemplate" class="headerlink" title="5、JdbcTemplate"></a>5、JdbcTemplate</h2><h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>​        为了使JDBC更加易于使用，Spring在JDBC API上定义了一个抽象层，以此建立一个JDBC存取框架。作为Spring JDBC框架的核心，JDBC模板的设计目的是为不同类型的JDBC操作提供模板方法，通过这种方式，可以在尽可能保留灵活性的情况下，将数据库存取的工作量降到最低。可以将Spring的JdbcTemplate看作是一个小型的轻量级持久化层框架，和我们之前使用过的DBUtils风格非常接近。</p>
<h3 id="5-2-环境准备"><a href="#5-2-环境准备" class="headerlink" title="5.2 环境准备"></a>5.2 环境准备</h3><ol>
<li><p>导入jar包</p>
<ul>
<li><p>IoC容器所需要的jar包</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">commons-logging-1.1.1.jar</span><br><span class="line">spring-beans-4.0.0.RELEASE.jar</span><br><span class="line">spring-context-4.0.0.RELEASE.jar spring-core-4.0.0.RELEASE.jar</span><br><span class="line">spring-expression-4.0.0.RELEASE.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>JdbcTemplate所需要的JAR包</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring-jdbc-4.0.0.RELEASE.jar</span><br><span class="line">spring-orm-4.0.0.RELEASE.jar</span><br><span class="line">spring-tx-4.0.0.RELEASE.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据库驱动和数据源</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">druid-1.0.9.jar</span><br><span class="line">mysql-connector-java-5.1.7-bin.jar</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>创建连接数据库的基本信息属性文件</p>
 <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span>=<span class="string">root </span></span><br><span class="line"><span class="attr">password</span>=<span class="string">201412 </span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/book_store?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">initialPoolSize</span>=<span class="string">30 </span></span><br><span class="line"><span class="attr">minPoolSize</span>=<span class="string">10 </span></span><br><span class="line"><span class="attr">maxPoolSize</span>=<span class="string">100 </span></span><br><span class="line"><span class="attr">acquireIncrement</span>=<span class="string">5 </span></span><br><span class="line"><span class="attr">maxStatements</span>=<span class="string">1000 </span></span><br><span class="line"><span class="attr">maxStatementsPerConnection</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在Spring配置文件中配置相关的bean</p>
<ul>
<li><p>数据源对象</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;user&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;driverClassName&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;initialPoolSize&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;minPoolSize&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;maxPoolSize&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"acquireIncrement"</span> <span class="attr">value</span>=<span class="string">"$&#123;acquireIncrement&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxStatements"</span> <span class="attr">value</span>=<span class="string">"$&#123;maxStatements&#125;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxStatementsPerConnection"</span> <span class="attr">value</span>=<span class="string">"$&#123;maxStatementsPerConnection&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>JdbcTemplate对象</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ol>
<h3 id="5-3-持久化操作"><a href="#5-3-持久化操作" class="headerlink" title="5.3 持久化操作"></a>5.3 持久化操作</h3><ul>
<li><p><strong>增删改：</strong><code>JdbcTemplate.update(String, Object...)</code></p>
</li>
<li><p><strong>批量增删改：</strong><code>JdbcTemplate.batchUpdate(String, List&lt;Object[]&gt;)</code></p>
<ul>
<li><strong>Object[]</strong>封装了SQL语句每一次执行时所需要的参数，而<strong>List集合</strong>封装了SQL语句多次执行时的所有参数。</li>
</ul>
</li>
<li><p><strong>查询单行：</strong><code>JdbcTemplate.queryForObject(String, RowMapper&lt;Department&gt;, Object...)</code></p>
</li>
</ul>
<p><img src="/2020/05/24/Spring/image-20200524221944432.png" alt="image-20200524221944432"></p>
<ul>
<li><strong>查询多行：</strong><code>JdbcTemplate.query(String, RowMapper&lt;Department&gt;, Object...)</code><ul>
<li>RowMapper对象依然可以使用BeanPropertyRowMapper。</li>
</ul>
</li>
<li><strong>查询单一值：</strong><code>JdbcTemplate.queryForObject(String, Class, Object...)</code></li>
</ul>
<h3 id="5-4-使用具名参数的JdbcTemplate"><a href="#5-4-使用具名参数的JdbcTemplate" class="headerlink" title="5.4 使用具名参数的JdbcTemplate"></a>5.4 使用具名参数的JdbcTemplate</h3><p><strong>在Spring中可以通过NamedParameterJdbcTemplate类的对象使用带有具名参数的SQL语句。</strong></p>
<ul>
<li><p>通过IOC容器创建NamedParameterJdbcTemplate对象</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置可以使用具名参数的JDBCTemplate类对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"namedTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 没有无参构造器，必须传入数据源或JdbcTemplate对象 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>具名参数在SQL语句中的格式</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> depts (dept_name) <span class="keyword">VALUES</span> (:deptName)</span><br></pre></td></tr></table></figure>
</li>
<li><p>具名参数传入</p>
<ol>
<li><p>通过Map对象传入：<strong>NamedParameterJdbcTemplate.update(String, Map&lt;String, ?&gt;)</strong><br> 其中Map的键是参数名，值是参数值。</p>
</li>
<li><p>通过SqlParameterSource对象传入<br> <img src="/2020/05/24/Spring/image-20200524222626187.png" alt="image-20200524222626187"></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"INSERT INTO depts (dept_name) VALUES (:deptName)"</span>;</span><br><span class="line">Department department = <span class="keyword">new</span> Department(<span class="keyword">null</span>, <span class="string">"YYY"</span>, <span class="keyword">null</span>);</span><br><span class="line">SqlParameterSource sqlParameterSource = <span class="keyword">new</span> BeanPropertySqlParameterSource(department);</span><br><span class="line">namedTemplate.update(sql, sqlParameterSource);</span><br></pre></td></tr></table></figure>



</li>
</ol>
</li>
</ul>
<h3 id="5-5-使用JdbcTemplate实现Dao"><a href="#5-5-使用JdbcTemplate实现Dao" class="headerlink" title="5.5 使用JdbcTemplate实现Dao"></a>5.5 使用JdbcTemplate实现Dao</h3><ol>
<li><p>通过IoC容器自动注入<br> JdbcTemplate类是线程安全的，所以可以在IoC容器中声明它的单个实例，并将这个实例注入到所有的Dao实例中。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeDao</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">get</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">		<span class="comment">//…</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>扩展JdbcDaoSupport类</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 不推荐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepartmentDao</span> <span class="keyword">extends</span> <span class="title">JdbcDaoSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDataSource2</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//父类提供的setDataSource()方法是final修饰的，不能通过覆盖的方式注入dataSource</span></span><br><span class="line">		setDataSource(dataSource);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Department <span class="title">get</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">		String sql = <span class="string">"SELECT id, dept_name name FROM departments WHERE id = ?"</span>;</span><br><span class="line">		RowMapper&lt;Department&gt; rowMapper = <span class="keyword">new</span> BeanPropertyRowMapper&lt;&gt;(Department<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		<span class="keyword">return</span> getJdbcTemplate().queryForObject(sql, rowMapper, id);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<p><strong>总结：JdbcTemplate如果比喻成手洗衣服的搓衣板的话，那么mybatis相当于半自动洗衣机，hibernate相当于全自动洗衣机。在实际应用的过程中更多的是使用mybatis。能够更加灵活的操作数据库。</strong></p>
<h2 id="6、声明式事务"><a href="#6、声明式事务" class="headerlink" title="6、声明式事务"></a>6、声明式事务</h2><h3 id="6-1-事务概述"><a href="#6-1-事务概述" class="headerlink" title="6.1 事务概述"></a>6.1 事务概述</h3><ul>
<li><p>在JavaEE企业级开发的应用领域，为了保证数据的完整性和一致性，必须引入数据库事务的概念，所以事务管理是企业级应用程序开发中必不可少的技术。</p>
</li>
<li><p>事务就是一组由于逻辑上紧密关联而合并成一个整体（工作单元）的多个数据库操作，这些操作要么都执行，要么都不执行。</p>
</li>
<li><p>事务的四个关键属性</p>
<ul>
<li><p>原子性（Atomicity）：“原子”的本意是“不可再分”，事务的原子性表现为一个事务中涉及到的多个操作在逻辑上缺一不可。事务的原子性要求事务中的所有操作要么都执行，要么都不执行。</p>
</li>
<li><p>一致性（Consistency）：“一致：指的是数据的一致，具体是指：所有数据都处于满足业务规则的一致性状态。一致性原则要求：一个事务中不管涉及到多少个操作，都必须保证事务执行之前数据是正确的，事务执行之后数据仍然是正确的。如果一个事务在执行过程中，其中某一个或某几个操作失败了，则必须将其他所有操作撤销，将数据恢复到事务执行之前的状态，这就是回滚。</p>
</li>
<li><p>隔离性（Isolation）：在应用程序实际运行过程中，事务往往是并发执行的，所以很有可能有许多事务同时处理相同的数据，因此每个事务都应该与其他事务隔离开来，防止数据损坏，隔离性原则要求多个事务在兵法执行过程中不会互相干扰。</p>
</li>
<li><p>持久性（Durability）：持久性原则要求事务执行完成之后，对数据的修改永久地保存下来，不会因各种系统错误或其他意外情况而受到影响，通常情况下，事务对数据的修改应被写入到持久化存储器中。</p>
<p>​    </p>
</li>
</ul>
</li>
</ul>
<h3 id="6-2-Spring事务管理"><a href="#6-2-Spring事务管理" class="headerlink" title="6.2 Spring事务管理"></a>6.2 Spring事务管理</h3><h4 id="6-2-1-编程式事务"><a href="#6-2-1-编程式事务" class="headerlink" title="6.2.1 编程式事务"></a>6.2.1 编程式事务</h4><ul>
<li><p>使用原生的JDBC API进行事务管理</p>
<ol>
<li>获取数据库连接Connection对象。</li>
<li>取消事务的自动提交。</li>
<li>执行操作</li>
<li>正常完成操作时手动提交事务。</li>
<li>执行失败时回滚事务。</li>
<li>关闭相关资源。</li>
</ol>
</li>
<li><p>评价</p>
<pre><code>使用原生的JDBC API实现事务管理是所有事务管理方式的基石，同时也是最典型的编程式事务管理。编程式事务管理需要将事务管理代码嵌入到业务方法中来控制事务的提交和回滚。在使用编程的方式管理事务时，必须在每个事务操作中包含额外的事务管理代码。相对于核心业务而言，事务管理的代码显然属于非核心业务，如果多个模块都是用同样模式的代码进行事务管理，显然会造成较大程度的代码冗余。</code></pre></li>
</ul>
<h4 id="6-2-2-声明式事务管理"><a href="#6-2-2-声明式事务管理" class="headerlink" title="6.2.2 声明式事务管理"></a>6.2.2 声明式事务管理</h4><p>​        大多数情况下声明式事务比编程式事务管理更好，它将事务管理代码从业务方法中分离出来，以声明的方式来实现事务管理。<br>​        事务管理代码的固定模式作为一种横切关注点，可以通过AOP方法模块化，进而借助Spring AOP框架实现声明式事务管理。<br>​        Spring在不同的事务管理API之上定义了一个抽象层，通过配置IDE方式使其生效，从而让应用程序开发人员不必了解事务管理API的底层实现细节，就可以使用Spring的事务管理机制。<br>​        Spring既支持编程式事务管理，也支持声明式的事务管理。</p>
<h4 id="6-2-3-Spring提供的事务管理器"><a href="#6-2-3-Spring提供的事务管理器" class="headerlink" title="6.2.3 Spring提供的事务管理器"></a>6.2.3 Spring提供的事务管理器</h4><p>​        Spring从不同的事务管理API中抽象出了一整套事务管理机制，让事务管理代码从特定的事务技术中独立出来。开发人员通过配置的方式进行事务管理，而不必了解其底层是如何实现的。<br>​        Spring的核心事务管理抽象是Plaform TransactionManager。它为事务管理封装了一组独立于技术的方法。无论使用Spring的哪种事务管理策略（编程式或声明式），事务管理器都是必须的。事务管理器可以以普通的bean的形式声明在Spring IOC容器中。</p>
<h4 id="6-2-4-事务管理器的主要实现"><a href="#6-2-4-事务管理器的主要实现" class="headerlink" title="6.2.4 事务管理器的主要实现"></a>6.2.4 事务管理器的主要实现</h4><ol>
<li>DataSourceTransactionManager：在应用程序中只需要处理一个数据源，而且通过JDBC存取。</li>
<li>JtaTransactionManager：在JavaEE应用服务器上用JTA(Java Transaction API)进行事务管理。</li>
<li>HibernateTransactionManager：用Hibernate框架存取数据库。</li>
</ol>
<p><img src="/2020/05/24/Spring/image-20200524160113400.png" alt="image-20200524160113400"></p>
<h3 id="6-3-测试数据准备"><a href="#6-3-测试数据准备" class="headerlink" title="6.3 测试数据准备"></a>6.3 测试数据准备</h3><h4 id="6-3-1-需求"><a href="#6-3-1-需求" class="headerlink" title="6.3.1 需求"></a>6.3.1 需求</h4><p><img src="/2020/05/24/Spring/image-20200524160243205.png" alt="image-20200524160243205"></p>
<h4 id="6-3-2-数据库表"><a href="#6-3-2-数据库表" class="headerlink" title="6.3.2 数据库表"></a>6.3.2 数据库表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> book (</span><br><span class="line">  isbn <span class="built_in">VARCHAR</span> (<span class="number">50</span>) PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  book_name <span class="built_in">VARCHAR</span> (<span class="number">100</span>),</span><br><span class="line">  price <span class="built_in">INT</span></span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> book_stock (</span><br><span class="line">  isbn <span class="built_in">VARCHAR</span> (<span class="number">50</span>) PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  stock <span class="built_in">INT</span>,</span><br><span class="line">  <span class="keyword">CHECK</span> (stock &gt; <span class="number">0</span>)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">account</span> (</span><br><span class="line">  username <span class="built_in">VARCHAR</span> (<span class="number">50</span>) PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  balance <span class="built_in">INT</span>,</span><br><span class="line">  <span class="keyword">CHECK</span> (balance &gt; <span class="number">0</span>)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">account</span> (<span class="string">`username`</span>,<span class="string">`balance`</span>) <span class="keyword">VALUES</span> (<span class="string">'Tom'</span>,<span class="number">100000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">account</span> (<span class="string">`username`</span>,<span class="string">`balance`</span>) <span class="keyword">VALUES</span> (<span class="string">'Jerry'</span>,<span class="number">150000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book (<span class="string">`isbn`</span>,<span class="string">`book_name`</span>,<span class="string">`price`</span>) <span class="keyword">VALUES</span> (<span class="string">'ISBN-001'</span>,<span class="string">'book01'</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book (<span class="string">`isbn`</span>,<span class="string">`book_name`</span>,<span class="string">`price`</span>) <span class="keyword">VALUES</span> (<span class="string">'ISBN-002'</span>,<span class="string">'book02'</span>,<span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book (<span class="string">`isbn`</span>,<span class="string">`book_name`</span>,<span class="string">`price`</span>) <span class="keyword">VALUES</span> (<span class="string">'ISBN-003'</span>,<span class="string">'book03'</span>,<span class="number">300</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book (<span class="string">`isbn`</span>,<span class="string">`book_name`</span>,<span class="string">`price`</span>) <span class="keyword">VALUES</span> (<span class="string">'ISBN-004'</span>,<span class="string">'book04'</span>,<span class="number">400</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book (<span class="string">`isbn`</span>,<span class="string">`book_name`</span>,<span class="string">`price`</span>) <span class="keyword">VALUES</span> (<span class="string">'ISBN-005'</span>,<span class="string">'book05'</span>,<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_stock (<span class="string">`isbn`</span>,<span class="string">`stock`</span>) <span class="keyword">VALUES</span> (<span class="string">'ISBN-001'</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_stock (<span class="string">`isbn`</span>,<span class="string">`stock`</span>) <span class="keyword">VALUES</span> (<span class="string">'ISBN-002'</span>,<span class="number">2000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_stock (<span class="string">`isbn`</span>,<span class="string">`stock`</span>) <span class="keyword">VALUES</span> (<span class="string">'ISBN-003'</span>,<span class="number">3000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_stock (<span class="string">`isbn`</span>,<span class="string">`stock`</span>) <span class="keyword">VALUES</span> (<span class="string">'ISBN-004'</span>,<span class="number">4000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> book_stock (<span class="string">`isbn`</span>,<span class="string">`stock`</span>) <span class="keyword">VALUES</span> (<span class="string">'ISBN-005'</span>,<span class="number">5000</span>);</span><br></pre></td></tr></table></figure>



<h3 id="6-4-初步实现"><a href="#6-4-初步实现" class="headerlink" title="6.4 初步实现"></a>6.4 初步实现</h3><ol>
<li>配置文件</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1、引入外部配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:dbconfig.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2、配置数据源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;user&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;driverClassName&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 3、配置JdbcTemplate操作数据库 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 4、配置事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span>	  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 5、启用事务注解，此操作依赖tx名称空间 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在需要进行事务控制的方法上加注解<strong>@Transactional</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkOut</span><span class="params">(String username, String isbn)</span> </span>&#123;</span><br><span class="line">        bookDao.updateStock(isbn, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">        bookDao.updateBalance(username, bookDao.getPrice(isbn));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="6-5-事务的传播行为"><a href="#6-5-事务的传播行为" class="headerlink" title="6.5 事务的传播行为"></a>6.5 事务的传播行为</h3><h4 id="6-5-1-简介"><a href="#6-5-1-简介" class="headerlink" title="6.5.1 简介"></a>6.5.1 简介</h4><p>​        当事务方法被另一个事务方法调用时，必须指定事务应该如何传播。 例如：方法可能继续在现有事务中运行，也可能开启一个新事务，并在自己的事务中运行。事务的传播行为可以由传播属性指定。 Spring定义了7种类传播行为。</p>
<table>
<thead>
<tr>
<th>传播属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>REQUIRED</strong></td>
<td><strong>如果有事务在运行，当前的方法就在这个事务内运行，否则，就启动一个新的事务，并在自己的事务内运行</strong></td>
</tr>
<tr>
<td><strong>REQUIRES_NEW</strong></td>
<td><strong>当前的方法必须启动新事务，并在它自己的事务内运行，如果有事务正在运行，应该将它挂起</strong></td>
</tr>
<tr>
<td>SUPPORTS</td>
<td>如果有事务在运行，当前的方法就在这个事务内运行，否则它可以不运行在事务中</td>
</tr>
<tr>
<td>NOT_SUPPORTED</td>
<td>当前的方法不应该运行在事务中，如果有运行的事务，将它挂起</td>
</tr>
<tr>
<td>MANDATORY</td>
<td>当前的方法必须运行在事务内部，如果没有正在运行的事务，就抛出异常</td>
</tr>
<tr>
<td>NEVER</td>
<td>当前的方法不应该运行在事务中，如果有运行的事务，就抛出异常</td>
</tr>
<tr>
<td>NESTED</td>
<td>如果有事务在运行，当前的方法就应该在这个事务的嵌套事务内运行，否则就启动一个新的事务，并在它自己的事务内运行</td>
</tr>
</tbody></table>
<p><strong>事务的传播属性可以在@Transactional注解的propagation属性中定义</strong></p>
<h4 id="6-5-2-测试"><a href="#6-5-2-测试" class="headerlink" title="6.5.2 测试"></a>6.5.2 测试</h4><p><img src="/2020/05/24/Spring/image-20200525121331811.png" alt="image-20200525121331811"></p>
<h4 id="6-5-3-说明"><a href="#6-5-3-说明" class="headerlink" title="6.5.3 说明"></a>6.5.3 说明</h4><ul>
<li>REQUIRED传播行为<br>  当bookService的purchase()方法被另一个事务方法checkout()调用时，它默认会在现有的事务内运行。这个默认的传播行为就是REQUIRED。因此在checkout()方法的开始和终止边界内只有一个事务。这个事务只在checkout()方法结束的时候被提交，结果用户一本书都买不了。<br>  <img src="/2020/05/24/Spring/image-20200525121429768.png" alt="image-20200525121429768"></li>
<li>REQUIRED_NEW传播行为<br>  表示该方法必须启动一个新事务，并在自己的事务内运行。如果有事务在运行，就应该先挂起它。<br>  <img src="/2020/05/24/Spring/image-20200525121500268.png" alt="image-20200525121500268"></li>
</ul>
<h4 id="6-5-4-补充"><a href="#6-5-4-补充" class="headerlink" title="6.5.4 补充"></a>6.5.4 补充</h4><p>在Spring 2.x事务通知中，可以像下面这样在tx:method元素中设定传播事务属性。</p>
<p><img src="/2020/05/24/Spring/image-20200525121549922.png" alt="image-20200525121549922"></p>
<h3 id="6-6-事务的隔离级别"><a href="#6-6-事务的隔离级别" class="headerlink" title="6.6 事务的隔离级别"></a>6.6 事务的隔离级别</h3><h4 id="6-6-1-数据库事务的并发问题"><a href="#6-6-1-数据库事务的并发问题" class="headerlink" title="6.6.1 数据库事务的并发问题"></a>6.6.1 数据库事务的并发问题</h4><p>假设现在有两个事务：Transaction01和Transaction02并发执行。</p>
<ul>
<li>脏读<ol>
<li>Transaction01将某条记录的AGE值从20修改为30。</li>
<li>Transaction02读取了Transaction01更新后的值：30。</li>
<li>Transaction01回滚，AGE值恢复到了20。</li>
<li>Transaction02读取到的30就是一个无效的值。</li>
</ol>
</li>
<li>不可重复读<ol>
<li>Transaction01读取了AGE值为20。</li>
<li>Transaction02将AGE值修改为30。</li>
<li>Transaction01再次读取AGE值为30，和第一次读取不一致。</li>
</ol>
</li>
<li>幻读<ol>
<li>Transaction01读取了STUDENT表中的一部分数据。</li>
<li>Transaction02向STUDENT表中插入了新的行。</li>
<li>Transaction01读取了STUDENT表时，多出了一些行。</li>
</ol>
</li>
</ul>
<h4 id="6-6-2-隔离级别"><a href="#6-6-2-隔离级别" class="headerlink" title="6.6.2 隔离级别"></a>6.6.2 隔离级别</h4><p>​        数据库系统必须具有隔离并发运行各个事务的能力，使它们不会相互影响，避免各种并发问题。 一个事务与其他事务隔离的程度称为隔离级别。 SQL标准中规定了多种事务隔离级别，不同隔离级别对应不同的干扰程度，隔离级别越高，数据一致性就越好，但并发性越弱。</p>
<ul>
<li>读未提交：READ_UNCOMMITTED<br>  允许Transaction01读取Transaction02未提交的修改。</li>
<li>读已提交：READ_COMMITTED<br>  要求Transaction01只能读取Transaction02已提交的修改。</li>
<li>可重复读：REPEATABLE_READ<br>  确保Transaction01可以多次从一个字段中读取到相同的值，即Transaction01执行期间禁止其它事务对这个字段进行更新。</li>
<li>串行化：SERIALIZABLE<br>  确保Transaction01可以多次从一个表中读取到相同的行，在Transaction01执行期间，禁止其它事务对这个表进行添加、更新、删除操作。可以避免任何并发问题，但性能十分低下。</li>
</ul>
<p>各个隔离级别解决并发问题的能力见下表：</p>
<table>
<thead>
<tr>
<th align="center">隔离级别</th>
<th align="center">脏读</th>
<th align="center">不可重复读</th>
<th align="center">幻读</th>
</tr>
</thead>
<tbody><tr>
<td align="center">READ_UNCOMMITTED</td>
<td align="center">有</td>
<td align="center">有</td>
<td align="center">有</td>
</tr>
<tr>
<td align="center">READ_COMMITTED</td>
<td align="center">无</td>
<td align="center">有</td>
<td align="center">有</td>
</tr>
<tr>
<td align="center">REPEATABLE_READ</td>
<td align="center">无</td>
<td align="center">无</td>
<td align="center">有</td>
</tr>
<tr>
<td align="center">SERIALIZABLE</td>
<td align="center">无</td>
<td align="center">无</td>
<td align="center">无</td>
</tr>
</tbody></table>
<p>各种数据库产品对事务隔离级别的支撑成都：</p>
<table>
<thead>
<tr>
<th align="center">隔离级别</th>
<th align="center">Oracle</th>
<th align="center">MySQL</th>
</tr>
</thead>
<tbody><tr>
<td align="center">READ_UNCOMMITTED</td>
<td align="center">×</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">READ_COMMITTED</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">REPEATABLE_READ</td>
<td align="center">×</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">SERIALIZABLE</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
</tbody></table>
<h4 id="6-6-3-在Spring中指定事务隔离级别"><a href="#6-6-3-在Spring中指定事务隔离级别" class="headerlink" title="6.6.3 在Spring中指定事务隔离级别"></a>6.6.3 在Spring中指定事务隔离级别</h4><ol>
<li><p>注解<br> 用@Transactional注解声明式地管理事务时可以在@Transactional的isolation属性中设置隔离级别。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* isolation = Isolation.READ_COMMITTED 将事务隔离级别设置为读已提交 */</span></span><br><span class="line">    <span class="meta">@Transactional</span>(isolation = Isolation.READ_COMMITTED)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkOut</span><span class="params">(String username, String isbn)</span> </span>&#123;</span><br><span class="line">        bookDao.updateStock(isbn, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">        bookDao.updateBalance(username, bookDao.getPrice(isbn));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li>xml<br> 在Spring 2.x事务通知中，可以在tx:method元素中指定隔离级别<br> <img src="/2020/05/24/Spring/image-20200525122445676.png" alt="image-20200525122445676"></li>
</ol>
<h3 id="6-7-触发事务回滚的异常"><a href="#6-7-触发事务回滚的异常" class="headerlink" title="6.7 触发事务回滚的异常"></a>6.7 触发事务回滚的异常</h3><h4 id="6-7-1-默认情况"><a href="#6-7-1-默认情况" class="headerlink" title="6.7.1 默认情况"></a>6.7.1 默认情况</h4><p><strong>捕获到RuntimeException或Error时回滚，而捕获到编译时异常不回滚。</strong></p>
<h4 id="6-7-2-设置途径"><a href="#6-7-2-设置途径" class="headerlink" title="6.7.2 设置途径"></a>6.7.2 设置途径</h4><ol>
<li><p>注解<br> <strong>@Transactional 注解</strong></p>
<ul>
<li><p><strong>rollbackFor属性：</strong>指定遇到时必须进行回滚的异常类型，可以为多个</p>
</li>
<li><p><strong>noRollbackFor属性：</strong>指定遇到时不回滚的异常类型，可以为多个</p>
<p><img src="/2020/05/24/Spring/image-20200525122645929.png" alt="image-20200525122645929"></p>
</li>
</ul>
</li>
<li><p>xml<br> 在Spring 2.x事务通知中，可以在tx:method元素中指定回滚规则。如果有不止一种异常则用逗号分隔。<br> <img src="/2020/05/24/Spring/image-20200525122715613.png" alt="image-20200525122715613"><br> 在Spring 2.x事务通知中，超时和只读属性可以在tx:method元素中进行指定<br> <img src="/2020/05/24/Spring/image-20200525122747267.png" alt="image-20200525122747267"></p>
</li>
</ol>
<h3 id="6-8-基于xml文档的声明式事务配置"><a href="#6-8-基于xml文档的声明式事务配置" class="headerlink" title="6.8 基于xml文档的声明式事务配置"></a>6.8 基于xml文档的声明式事务配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置事务切面 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.atguigu.tx.component.service.BookShopServiceImpl.purchase(..))"</span> <span class="attr">id</span>=<span class="string">"txPointCut"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将切入点表达式和事务属性配置关联到一起 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"myTx"</span> <span class="attr">pointcut-ref</span>=<span class="string">"txPointCut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置基于XML的声明式事务  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"myTx"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置具体方法的事务属性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"purchase"</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">isolation</span>=<span class="string">"READ_COMMITTED"</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">no-rollback-for</span>=<span class="string">"java.lang.ArithmeticException,java.lang.NullPointerException"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">propagation</span>=<span class="string">"REQUIRES_NEW"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">read-only</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">timeout</span>=<span class="string">"10"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/19/HashMap%E9%AB%98%E7%BA%A7/" rel="next" title="HashMap高级">
                <i class="fa fa-chevron-left"></i> HashMap高级
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/05/25/SpringMVC/" rel="prev" title="SpringMVC">
                SpringMVC <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="hgx98" />
            
              <p class="site-author-name" itemprop="name">hgx98</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#一、IOC"><span class="nav-text">一、IOC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、编写HelloWorld流程"><span class="nav-text">1、编写HelloWorld流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、给bean的属性赋值"><span class="nav-text">2、给bean的属性赋值</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-赋值的途径"><span class="nav-text">2.1 赋值的途径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-可以使用的值"><span class="nav-text">2.2 可以使用的值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-集合属性"><span class="nav-text">2.3 集合属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、bean的高级配置"><span class="nav-text">3、bean的高级配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-继承"><span class="nav-text">3.1 继承</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-bean之间的依赖"><span class="nav-text">3.2 bean之间的依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-bean的作用域"><span class="nav-text">3.3 bean的作用域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-bean的生命周期"><span class="nav-text">3.4 bean的生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-引用外部属性文件"><span class="nav-text">3.5 引用外部属性文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-自动装配"><span class="nav-text">3.6 自动装配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-通过abstract创建一个模板bean"><span class="nav-text">3.7 通过abstract创建一个模板bean</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、静态工厂与实例工厂"><span class="nav-text">4、静态工厂与实例工厂</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、SpEL"><span class="nav-text">5、SpEL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、通过注解创建Dao、service、Controller"><span class="nav-text">6、通过注解创建Dao、service、Controller</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、DI（依赖注入）"><span class="nav-text">7、DI（依赖注入）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、AOP"><span class="nav-text">二、AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、AOP概述"><span class="nav-text">1、AOP概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、AOP术语"><span class="nav-text">2、AOP术语</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、AspectJ"><span class="nav-text">3、AspectJ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-简介"><span class="nav-text">3.1 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-在Spring中启用AspectJ注解支持"><span class="nav-text">3.2 在Spring中启用AspectJ注解支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-用AspectJ注解声明切面"><span class="nav-text">3.3 用AspectJ注解声明切面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-切入点表达式"><span class="nav-text">3.4 切入点表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-实际应用"><span class="nav-text">3.5 实际应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-当前连接点细节"><span class="nav-text">3.6 当前连接点细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-重用切入点定义"><span class="nav-text">3.7 重用切入点定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-指定切面的优先级"><span class="nav-text">3.8 指定切面的优先级</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、AOP以xml方式配置切面"><span class="nav-text">4、AOP以xml方式配置切面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-概述"><span class="nav-text">4.1 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-配置细节"><span class="nav-text">4.2 配置细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-声明切入点"><span class="nav-text">4.3 声明切入点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-声明通知"><span class="nav-text">4.4 声明通知</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、JdbcTemplate"><span class="nav-text">5、JdbcTemplate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-概述"><span class="nav-text">5.1 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-环境准备"><span class="nav-text">5.2 环境准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-持久化操作"><span class="nav-text">5.3 持久化操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-使用具名参数的JdbcTemplate"><span class="nav-text">5.4 使用具名参数的JdbcTemplate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-使用JdbcTemplate实现Dao"><span class="nav-text">5.5 使用JdbcTemplate实现Dao</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、声明式事务"><span class="nav-text">6、声明式事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-事务概述"><span class="nav-text">6.1 事务概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-Spring事务管理"><span class="nav-text">6.2 Spring事务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-编程式事务"><span class="nav-text">6.2.1 编程式事务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-2-声明式事务管理"><span class="nav-text">6.2.2 声明式事务管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-Spring提供的事务管理器"><span class="nav-text">6.2.3 Spring提供的事务管理器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-4-事务管理器的主要实现"><span class="nav-text">6.2.4 事务管理器的主要实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-测试数据准备"><span class="nav-text">6.3 测试数据准备</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-1-需求"><span class="nav-text">6.3.1 需求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-2-数据库表"><span class="nav-text">6.3.2 数据库表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-初步实现"><span class="nav-text">6.4 初步实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-事务的传播行为"><span class="nav-text">6.5 事务的传播行为</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-1-简介"><span class="nav-text">6.5.1 简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-2-测试"><span class="nav-text">6.5.2 测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-3-说明"><span class="nav-text">6.5.3 说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-4-补充"><span class="nav-text">6.5.4 补充</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-6-事务的隔离级别"><span class="nav-text">6.6 事务的隔离级别</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-6-1-数据库事务的并发问题"><span class="nav-text">6.6.1 数据库事务的并发问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-6-2-隔离级别"><span class="nav-text">6.6.2 隔离级别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-6-3-在Spring中指定事务隔离级别"><span class="nav-text">6.6.3 在Spring中指定事务隔离级别</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-7-触发事务回滚的异常"><span class="nav-text">6.7 触发事务回滚的异常</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-7-1-默认情况"><span class="nav-text">6.7.1 默认情况</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-7-2-设置途径"><span class="nav-text">6.7.2 设置途径</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-8-基于xml文档的声明式事务配置"><span class="nav-text">6.8 基于xml文档的声明式事务配置</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hgx98</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
